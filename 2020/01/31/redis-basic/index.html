<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">

<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/green/pace-theme-flash.css" rel="stylesheet">



<script>
    (function () {
        if ('') {
            if (prompt('è¯·è¾“å…¥æ–‡ç« å¯†ç ') !== '') {
                alert('å¯†ç é”™è¯¯ï¼');
                if (history.length === 1) {
                    location.replace("http://liubaoshuai.com/"); // è¿™é‡Œæ›¿æ¢æˆä½ çš„é¦–é¡µ
                } else {
                    history.back();
                }
            }
        }
    })();
</script>
  <link rel="apple-touch-icon" sizes="180x180" href="https://image-bed-20181207-1257458714.cos.ap-shanghai.myqcloud.com/Blog-20190315/blog-logo-1.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="https://image-bed-20181207-1257458714.cos.ap-shanghai.myqcloud.com/Blog-20190315/blog-logo-1.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="https://image-bed-20181207-1257458714.cos.ap-shanghai.myqcloud.com/Blog-20190315/blog-logo-1.jpg">
  <link rel="mask-icon" href="https://image-bed-20181207-1257458714.cos.ap-shanghai.myqcloud.com/Blog-20190315/blog-logo-1.jpg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"lbs0912.github.io","root":"/","scheme":"Pisces","version":"7.7.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="å¯¹ Redis åŸºç¡€çŸ¥è¯†è¿›è¡Œæ¢³ç†ï¼ŒåŒ…æ‹¬Redisçš„5ç§æ•°æ®ç±»å‹ï¼Œäº‹åŠ¡ï¼Œè¿‡æœŸæ—¶é—´ï¼Œæ¶ˆæ¯é€šçŸ¥ï¼Œä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œç®¡é“ï¼Œæ•°æ®æŒä¹…åŒ–ï¼Œå¤åˆ¶ï¼Œå“¨å…µï¼Œäº‹åŠ¡ç­‰">
<meta name="keywords" content="Back-End,DataBase,Redis">
<meta property="og:type" content="article">
<meta property="og:title" content="RedisåŸºç¡€çŸ¥è¯†æ¢³ç†">
<meta property="og:url" content="https:&#x2F;&#x2F;lbs0912.github.io&#x2F;2020&#x2F;01&#x2F;31&#x2F;redis-basic&#x2F;index.html">
<meta property="og:site_name" content="Liu Baoshuai&#39;s Blog">
<meta property="og:description" content="å¯¹ Redis åŸºç¡€çŸ¥è¯†è¿›è¡Œæ¢³ç†ï¼ŒåŒ…æ‹¬Redisçš„5ç§æ•°æ®ç±»å‹ï¼Œäº‹åŠ¡ï¼Œè¿‡æœŸæ—¶é—´ï¼Œæ¶ˆæ¯é€šçŸ¥ï¼Œä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œç®¡é“ï¼Œæ•°æ®æŒä¹…åŒ–ï¼Œå¤åˆ¶ï¼Œå“¨å…µï¼Œäº‹åŠ¡ç­‰">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https:&#x2F;&#x2F;image-bed-20181207-1257458714.cos.ap-shanghai.myqcloud.com&#x2F;back-end-2020&#x2F;redis-basic-pipelining-1.png">
<meta property="og:image" content="https:&#x2F;&#x2F;image-bed-20181207-1257458714.cos.ap-shanghai.myqcloud.com&#x2F;back-end-2020&#x2F;redis-basic-guard-1.png">
<meta property="og:image" content="https:&#x2F;&#x2F;image-bed-20181207-1257458714.cos.ap-shanghai.myqcloud.com&#x2F;back-end-2020&#x2F;redis-basic-guard-2.png">
<meta property="og:updated_time" content="2020-02-23T08:48:04.366Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;image-bed-20181207-1257458714.cos.ap-shanghai.myqcloud.com&#x2F;back-end-2020&#x2F;redis-basic-pipelining-1.png">

<link rel="canonical" href="https://lbs0912.github.io/2020/01/31/redis-basic/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>RedisåŸºç¡€çŸ¥è¯†æ¢³ç† | Liu Baoshuai's Blog</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?17082ee15df20dad9762c5512f336eb2";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
    <a href="https://github.com/lbs0912" target="_blank" rel="noopener" class="github-corner" aria-label="View source on GitHub">
      <svg width="80" height="80" viewBox="0 0 250 250" 
            style="fill:#151513; color:#fff; position: fixed; top: 0; border: 0; right: 0;" aria-hidden="true">
              <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
              <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
              <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
      </svg>
    </a>
    <style>
      .github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}
    </style>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Liu Baoshuai's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">Do one thing at a time and do well</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>å½’æ¡£</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="off"
           placeholder="æœç´¢..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lbs0912.github.io/2020/01/31/redis-basic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://image-bed-20181207-1257458714.cos.ap-shanghai.myqcloud.com/Blog-20190315/blog-logo-1.jpg">
      <meta itemprop="name" content="Liu Baoshuai">
      <meta itemprop="description" content="Record and become better myself">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liu Baoshuai's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          RedisåŸºç¡€çŸ¥è¯†æ¢³ç†
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-01-31 10:25:26" itemprop="dateCreated datePublished" datetime="2020-01-31T10:25:26+08:00">2020-01-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2020-02-23 16:48:04" itemprop="dateModified" datetime="2020-02-23T16:48:04+08:00">2020-02-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Back-End/" itemprop="url" rel="index"><span itemprop="name">Back-End</span></a>
                </span>
            </span>

          
            <span id="/2020/01/31/redis-basic/" class="post-meta-item leancloud_visitors" data-flag-title="RedisåŸºç¡€çŸ¥è¯†æ¢³ç†" title="é˜…è¯»æ¬¡æ•°">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span class="leancloud-visitors-count"></span>
            </span>
            <span class="post-meta-item" title="é˜…è¯»æ¬¡æ•°" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">é˜…è¯»æ¬¡æ•°ï¼š</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/2020/01/31/redis-basic/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/01/31/redis-basic/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <ul>
<li>å¯¹ Redis åŸºç¡€çŸ¥è¯†è¿›è¡Œæ¢³ç†ï¼ŒåŒ…æ‹¬Redisçš„5ç§æ•°æ®ç±»å‹ï¼Œäº‹åŠ¡ï¼Œè¿‡æœŸæ—¶é—´ï¼Œæ¶ˆæ¯é€šçŸ¥ï¼Œä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œç®¡é“ï¼Œæ•°æ®æŒä¹…åŒ–ï¼Œå¤åˆ¶ï¼Œå“¨å…µï¼Œäº‹åŠ¡ç­‰</li>
</ul>
<a id="more"></a>

<h2 id="æ›´æ–°æ—¥å¿—"><a href="#æ›´æ–°æ—¥å¿—" class="headerlink" title="æ›´æ–°æ—¥å¿—"></a>æ›´æ–°æ—¥å¿—</h2><ul>
<li>2020/01/30ï¼Œæ’°å†™</li>
</ul>
<h2 id="å­¦ä¹ èµ„æ–™æ±‡æ€»"><a href="#å­¦ä¹ èµ„æ–™æ±‡æ€»" class="headerlink" title="å­¦ä¹ èµ„æ–™æ±‡æ€»"></a>å­¦ä¹ èµ„æ–™æ±‡æ€»</h2><ul>
<li><a href="https://redis.io/" target="_blank" rel="noopener">Rediså®˜ç½‘</a></li>
<li><a href="http://www.redis.cn/" target="_blank" rel="noopener">Redisä¸­æ–‡å®˜ç½‘</a></li>
<li><a href="https://www.runoob.com/redis/redis-tutorial.html" target="_blank" rel="noopener">Redisèœé¸Ÿæ•™ç¨‹</a></li>
<li><a href="https://github.com/antirez/redis" target="_blank" rel="noopener">Redisæºç </a> â€”â€” ä½¿ç”¨Cè¯­è¨€å¼€å‘ï¼Œæºç åªæœ‰3ä¸‡å¤šè¡Œï¼Œé™ä½äº†ç”¨æˆ·é€šè¿‡ä¿®æ”¹Redisæºç æ¥æå‡æ€§èƒ½çš„é—¨æ§›</li>
</ul>
<h2 id="Redis-åˆè¯†"><a href="#Redis-åˆè¯†" class="headerlink" title="Redis åˆè¯†"></a>Redis åˆè¯†</h2><ul>
<li>Redis = Remote Dictionary Serverï¼Œè¿œç¨‹å­—å…¸æœåŠ¡å™¨</li>
<li>Redis æ˜¯ä¸€ä¸ª é«˜æ€§èƒ½çš„ <code>key-value</code> å­˜å‚¨ç³»ç»Ÿï¼Œé€šå¸¸è¢«ç§°ä¸ºæ•°æ®ç»“æ„æœåŠ¡å™¨ï¼Œå› ä¸ºå€¼ï¼ˆvalueï¼‰å¯ä»¥æ˜¯ å­—ç¬¦ä¸²(String), å“ˆå¸Œ(Hash), åˆ—è¡¨(list), é›†åˆ(sets) å’Œæœ‰åºé›†åˆ(sorted sets)ç­‰ç±»å‹ã€‚</li>
<li>Redis ä¸å…¶ä»– <code>key - value</code> ç¼“å­˜äº§å“æœ‰ä»¥ä¸‹3ä¸ªç‰¹ç‚¹<ol>
<li>Redisæ”¯æŒæ•°æ®çš„æŒä¹…åŒ–ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®ä¿å­˜åœ¨ç£ç›˜ä¸­ï¼Œé‡å¯çš„æ—¶å€™å¯ä»¥å†æ¬¡åŠ è½½è¿›è¡Œä½¿ç”¨</li>
<li>Redisä¸ä»…ä»…æ”¯æŒç®€å•çš„key-valueç±»å‹çš„æ•°æ®ï¼ŒåŒæ—¶è¿˜æä¾›listï¼Œsetï¼Œzsetï¼Œhashç­‰æ•°æ®ç»“æ„çš„å­˜å‚¨</li>
<li>Redisæ”¯æŒæ•°æ®çš„å¤‡ä»½ï¼Œå³master-slaveæ¨¡å¼çš„æ•°æ®å¤‡ä»½</li>
</ol>
</li>
<li>Redis æ€§èƒ½æé«˜ï¼Œè¯»å–é€Ÿåº¦æ˜¯110000æ¬¡/sï¼Œå†™å…¥çš„é€Ÿåº¦æ˜¯81000æ¬¡/sã€‚Redisæ•°æ®åº“ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå†…å­˜è¯»å†™é€Ÿåº¦è¿œå¿«äºç£ç›˜ã€‚</li>
<li>RedisåŠŸèƒ½ä¸°å¯Œï¼Œé™¤äº†ç”¨äºæ•°æ®åº“å¼€å‘ï¼Œè¿˜å¯ä»¥ç”¨äºç¼“å­˜ï¼Œé˜Ÿåˆ—ç³»ç»Ÿç­‰ã€‚</li>
<li>Redisçš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ï¼Œæ„æ€å°±æ˜¯è¦ä¹ˆæˆåŠŸæ‰§è¡Œè¦ä¹ˆå¤±è´¥å®Œå…¨ä¸æ‰§è¡Œã€‚å•ä¸ªæ“ä½œæ˜¯åŸå­æ€§çš„ã€‚å¤šä¸ªæ“ä½œä¹Ÿæ”¯æŒäº‹åŠ¡ï¼Œå³åŸå­æ€§ï¼Œé€šè¿‡MULTIå’ŒEXECæŒ‡ä»¤åŒ…èµ·æ¥ã€‚</li>
</ul>
<h2 id="Redisç¯å¢ƒé…ç½®"><a href="#Redisç¯å¢ƒé…ç½®" class="headerlink" title="Redisç¯å¢ƒé…ç½®"></a>Redisç¯å¢ƒé…ç½®</h2><h3 id="å®‰è£…-Redis"><a href="#å®‰è£…-Redis" class="headerlink" title="å®‰è£… Redis"></a>å®‰è£… Redis</h3><ul>
<li>Macä¸Šï¼Œå»ºè®®ä½¿ç”¨Homebrewå®‰è£…Redis</li>
</ul>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">brew install redis    <span class="comment">//ä¼šé»˜è®¤å®‰è£…å½“å‰æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/// æ­¤å¤„å®‰è£…è·¯å¾„ä¸º usr/local/Cellar/redis/5.0.7</span></span><br><span class="line"><span class="comment">//==&gt; Caveats</span></span><br><span class="line"><span class="comment">// To have launchd start redis now and restart at login:</span></span><br><span class="line"><span class="comment">//  brew services start redis</span></span><br><span class="line"><span class="comment">//Or, if you don't want/need a background service you can just run:</span></span><br><span class="line"><span class="comment">//  redis-server /usr/local/etc/redis.conf</span></span><br><span class="line"><span class="comment">//==&gt; Summary</span></span><br><span class="line"><span class="comment">//ğŸº  /usr/local/Cellar/redis/5.0.7: 13 files, 3.1MB</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å¦‚æœéœ€è¦åå°è¿è¡ŒRedisæœåŠ¡ï¼Œä½¿ç”¨å‘½ä»¤ <code>brew services start redis</code></li>
<li>å¦‚æœä¸éœ€è¦åå°è¿è¡ŒRedisæœåŠ¡ï¼Œä½¿ç”¨å‘½ä»¤ <code>redis-server /usr/local/etc/redis.conf</code></li>
</ul>
<h3 id="å¯åŠ¨-åœæ­¢Redis"><a href="#å¯åŠ¨-åœæ­¢Redis" class="headerlink" title="å¯åŠ¨/åœæ­¢Redis"></a>å¯åŠ¨/åœæ­¢Redis</h3><p>æ‰§è¡Œ <code>brew services start redi</code> å‘½ä»¤ï¼Œç¬¬ä¸€æ¬¡å¯åŠ¨ Redis åï¼Œåœ¨ <code>/usr/local/bin</code> ç›®å½•ä¸‹ï¼Œä¼šç”Ÿæˆå¦‚ä¸‹æ–‡ä»¶å¤¹</p>
<table>
<thead>
<tr>
<th>æ–‡ä»¶å</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>redis-server</td>
<td>redis æœåŠ¡å™¨</td>
</tr>
<tr>
<td>redis-cli</td>
<td>redis å‘½ä»¤è¡Œå®¢æˆ·ç«¯</td>
</tr>
<tr>
<td>redis-benchmark</td>
<td>redis æ€§èƒ½æµ‹è¯•å·¥å…·</td>
</tr>
<tr>
<td>redis-check-aof</td>
<td>AOF æ–‡ä»¶ä¿®å¤å·¥å…·</td>
</tr>
<tr>
<td>redis-check-dump</td>
<td>RDB æ–‡ä»¶æ£€æŸ¥å·¥å…·</td>
</tr>
<tr>
<td>redis-sentinel</td>
<td>Sentinel æœåŠ¡å™¨</td>
</tr>
</tbody></table>
<ul>
<li>å¯åŠ¨Redis</li>
</ul>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-<span class="keyword">server</span>   <span class="comment">//é»˜è®¤ç«¯å£å· 6379</span></span><br><span class="line"></span><br><span class="line">redis-<span class="keyword">server</span> --port <span class="number">6380</span>  <span class="comment">//æŒ‡å®šç«¯å£å·</span></span><br></pre></td></tr></table></figure>

<ul>
<li>åœæ­¢Redis</li>
</ul>
<p>è€ƒè™‘åˆ° Redis æœ‰å¯èƒ½æ­£åœ¨å°†å†…å­˜ä¸­æ•°æ®åŒæ­¥åˆ°ç¡¬ç›˜ä¸­ï¼Œå¼ºè¡Œç»ˆæ­¢Redisè¿›ç¨‹å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚å› æ­¤ï¼Œæ­£ç¡®åœæ­¢Redisçš„æ–¹å¼åº”è¯¥æ˜¯å‘Rediså‘é€ <code>SHUTDOWN</code> å‘½ä»¤ï¼Œæ–¹æ³•ä¸º</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli <span class="built_in">SHUTDOWN</span></span><br></pre></td></tr></table></figure>

<p>å½“ Redis æ”¶åˆ° <code>SHUTDOWN</code>  å‘½ä»¤åï¼Œä¼šå…ˆæ–­å¼€æ‰€æœ‰å®¢æˆ·ç«¯è¿æ¥ï¼Œç„¶åæ ¹æ®é…ç½®æ‰§è¡Œæ•°æ®æŒä¹…åŒ–ï¼Œæœ€åå®Œæˆé€€å‡ºã€‚</p>
<p>Redis å¯ä»¥å¦¥å–„å¤„ç† <code>SIGTERM</code> ä¿¡å·ï¼Œæ‰€ä»¥ä½¿ç”¨ <code>kill</code> Redis è¿›ç¨‹çš„ PIDï¼Œä¹Ÿå¯ä»¥æ­£å¸¸ç»“æŸ Redisï¼Œæ•ˆæœå’Œå‘é€ <code>SHUTDOWN</code> å‘½ä»¤ä¸€æ ·ã€‚</p>
<h3 id="redis-cli"><a href="#redis-cli" class="headerlink" title="redis-cli"></a>redis-cli</h3><p>Redis å‘½ä»¤ç”¨äºåœ¨ Redis æœåŠ¡ä¸Šæ‰§è¡Œæ“ä½œã€‚è¦åœ¨ Redis æœåŠ¡ä¸Šæ‰§è¡Œå‘½ä»¤éœ€è¦ä¸€ä¸ª Redis å®¢æˆ·ç«¯ã€‚</p>
<p><code>redis-cli</code> æ˜¯Redisè‡ªå¸¦çš„åŸºäºå‘½ä»¤è¡Œçš„Rediså®¢æˆ·ç«¯ï¼Œä¸‹é¢ä»‹ç»å¦‚æœé€šè¿‡ <code>redis-cli</code> å‘ Redis å‘é€å‘½ä»¤ã€‚</p>
<p>é€šè¿‡ <code>redis-cli</code> å‘ Redis å‘é€å‘½ä»¤æœ‰2ç§æ–¹å¼</p>
<ul>
<li>æ–¹å¼1ï¼šå°†å‘½ä»¤ä½œä¸º <code>redis-cli</code> çš„å‚æ•°æ‰§è¡Œã€‚ä¾‹å¦‚ <code>redis-cli SHUTDOWN</code></li>
<li>æ–¹å¼2ï¼šæ‰§è¡Œ <code>redis-cli</code>ï¼ˆä¸é™„å¸¦ä»»ä½•å‚æ•°ï¼‰ï¼Œè¿›å…¥äº¤äº’æ¨¡å¼åï¼Œå¯ä»¥è‡ªç”±è¾“å…¥å‘½ä»¤</li>
</ul>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–¹å¼1ï¼šå°†å‘½ä»¤ä½œä¸º redis-cli çš„å‚æ•°æ‰§è¡Œ</span></span><br><span class="line"></span><br><span class="line">redis-cli SHUTDOWN</span><br><span class="line"></span><br><span class="line"><span class="comment">//redisé»˜è®¤æœåŠ¡å™¨åœ°å€127.0.0.1ï¼Œé»˜è®¤ç«¯å£å·6379 </span></span><br><span class="line"><span class="comment">//ä¹Ÿå¯ä»¥ä½¿ç”¨-hæŒ‡å®šæœåŠ¡å™¨åœ°å€ï¼Œ-pæŒ‡å®šç«¯å£å·</span></span><br><span class="line">redis-cli -h <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> -p <span class="number">6379</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨PINGå‘½ä»¤æµ‹è¯•å®¢æˆ·ç«¯å’ŒRedisçš„è¿æ¥æ˜¯å¦æ­£å¸¸</span></span><br><span class="line">redis-cli PING  <span class="comment">//è¿”å›PONG è¡¨ç¤ºè¿æ¥æ­£å¸¸</span></span><br></pre></td></tr></table></figure>


<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ–¹å¼2: æ‰§è¡Œ redis-cliï¼ˆä¸é™„å¸¦ä»»ä½•å‚æ•°ï¼‰ï¼Œè¿›å…¥äº¤äº’æ¨¡å¼åï¼Œå¯ä»¥è‡ªç”±è¾“å…¥å‘½ä»¤</span></span><br><span class="line">lbsMacBook-Pro:~ lbs$ redis-cli</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; PING</span><br><span class="line">PONG</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt;</span><br></pre></td></tr></table></figure>



<h3 id="å¤šæ•°æ®åº“"><a href="#å¤šæ•°æ®åº“" class="headerlink" title="å¤šæ•°æ®åº“"></a>å¤šæ•°æ®åº“</h3><p>Redis æ˜¯ä¸€ä¸ªå­—å…¸ç»“æ„çš„å­˜å‚¨æœåŠ¡å™¨ï¼Œ<strong>ä¸€ä¸ª Redis å®ä¾‹</strong>æä¾›äº†å¤šä¸ªç”¨æ¥å­˜å‚¨çš„å­—å…¸ï¼Œå¯ä»¥æŠŠå…¶ä¸­çš„æ¯ä¸ªå­—å…¸éƒ½ç†è§£æˆä¸€ä¸ªç‹¬ç«‹çš„æ•°æ®åº“ã€‚</p>
<ul>
<li>æ¯ä¸ªæ•°æ®åº“å¯¹å¤–éƒ½æ˜¯ä¸€ä¸ªä»0å¼€å§‹çš„é€’å¢æ•°å­—å‘½åï¼ŒRedisé»˜è®¤æ”¯æŒ16ä¸ªæ•°æ®åº“</li>
<li>Redisä¸æ”¯æŒè‡ªå®šä¹‰æ•°æ®åº“åç§°ï¼Œæ¯ä¸ªæ•°æ®åº“éƒ½ä»¥ç¼–å·å‘½å</li>
<li>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€ä¸ªRediså®ä¾‹çš„å¤šä¸ªæ•°æ®åº“ä¹‹é—´å¹¶ä¸æ˜¯å®Œå…¨éš”ç¦»çš„ï¼Œæ¯”å¦‚ <code>FLUSHALL</code> å‘½ä»¤å¯ä»¥æ¸…ç©ºä¸€ä¸ª Redis å®ä¾‹ä¸­æ‰€æœ‰æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œè¿™äº›æ•°æ®åº“æ›´åƒæ˜¯ä¸€ç§å‘½åç©ºé—´ï¼Œè€Œä¸é€‚å®œå­˜å‚¨ä¸åŒåº”ç”¨ç¨‹åºçš„æ•°æ®ã€‚æ¯”å¦‚ï¼Œå¯ä»¥ä½¿ç”¨0å·æ•°æ®åº“å­˜å‚¨åº”ç”¨Açš„ç”Ÿäº§ç¯å¢ƒæ•°æ®ï¼Œä½¿ç”¨1å·æ•°æ®åº“å­˜å‚¨åº”ç”¨Açš„æµ‹è¯•ç¯å¢ƒæ•°æ®ï¼Œè€Œä¸åº”è¯¥ä½¿ç”¨1å·æ•°æ®åº“å­˜å‚¨åº”ç”¨Bçš„æ•°æ®ã€‚</li>
<li><strong>ä¸åŒçš„åº”ç”¨ï¼Œåº”è¯¥ä½¿ç”¨ä¸åŒçš„Rediså®ä¾‹å­˜å‚¨æ•°æ®ã€‚</strong> ç”±äºRediséå¸¸è½»é‡ï¼Œä¸€ä¸ªç©ºçš„Rediså®ä¾‹å ç”¨çš„å†…å­˜åªæœ‰1MBï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒå¤šä¸ªRediså®ä¾‹ä¼šé¢å¤–å ç”¨å¾ˆå¤šå†…å­˜ã€‚</li>
</ul>
<h2 id="Redis-å…¥é—¨"><a href="#Redis-å…¥é—¨" class="headerlink" title="Redis å…¥é—¨"></a>Redis å…¥é—¨</h2><h3 id="å‘½ä»¤è¡ŒåŸºç¡€"><a href="#å‘½ä»¤è¡ŒåŸºç¡€" class="headerlink" title="å‘½ä»¤è¡ŒåŸºç¡€"></a>å‘½ä»¤è¡ŒåŸºç¡€</h3><ol>
<li>è·å¾—ç¬¦åˆè§„åˆ™çš„é”®ååˆ—è¡¨</li>
</ol>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">KEYS <span class="built_in">pattern</span></span><br></pre></td></tr></table></figure>

<p><code>pattern</code> æ”¯æŒ <code>glob</code> é£æ ¼é€šé…ç¬¦æ ¼å¼ï¼Œå…·ä½“å¦‚ä¸‹</p>
<table>
<thead>
<tr>
<th>ç¬¦å·</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>?</td>
<td>åŒ¹é…ä¸€ä¸ªå­—ç¬¦</td>
</tr>
<tr>
<td>*</td>
<td>åŒ¹é…ä»»æ„ä¸ªï¼ˆåŒ…æ‹¬0ä¸ªï¼‰å­—ç¬¦</td>
</tr>
<tr>
<td>[]</td>
<td>åŒ¹é…æ‹¬å·é—´çš„ä»»ä¸€å­—ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨ <code>-</code> è¡¨ç¤ºä¸€ä¸ªèŒƒå›´ï¼Œå¦‚ <code>[1-9]</code></td>
</tr>
<tr>
<td>\x</td>
<td>ç”¨äºè½¬ä¹‰å­—ç¬¦</td>
</tr>
</tbody></table>
<p>ä¾‹å¦‚ï¼ŒæŸ¥è¯¢å½“å‰çš„æ‰€æœ‰é”®ååˆ—è¡¨</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">set</span> bar <span class="comment">1</span></span><br><span class="line">OK</span><br><span class="line">&gt; KEYS <span class="comment">*</span></span><br><span class="line">1) <span class="string">"bar"</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åˆ¤æ–­ä¸€ä¸ªé”®æ˜¯å¦å­˜åœ¨</li>
</ol>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">EXISTS <span class="built_in">key</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿”å›(integer) 1ï¼Œè¡¨ç¤ºå­˜åœ¨</span></span><br><span class="line"><span class="comment">//è¿”å›(integer) 0ï¼Œè¡¨ç¤ºä¸å­˜åœ¨</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>åˆ é™¤é”®</li>
</ol>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DEL <span class="built_in">key</span> [<span class="built_in">key</span> ...]</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿”å›(integer) 1ï¼Œè¡¨ç¤ºåˆ é™¤æˆåŠŸ</span></span><br><span class="line"><span class="comment">//è¿”å›(integer) 0ï¼Œè¡¨ç¤ºåˆ é™¤ä¸æˆåŠŸ</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>è·å¾—é”®å€¼çš„æ•°æ®ç±»å‹</li>
</ol>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">TYPE</span> <span class="built_in">key</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿”å› string list ç­‰</span></span><br></pre></td></tr></table></figure>



<h3 id="Redis-5-ç§æ•°æ®ç±»å‹"><a href="#Redis-5-ç§æ•°æ®ç±»å‹" class="headerlink" title="Redis 5 ç§æ•°æ®ç±»å‹"></a>Redis 5 ç§æ•°æ®ç±»å‹</h3><p>Redis æ”¯æŒ5ç§æ•°æ®ç±»å‹</p>
<ul>
<li>stringï¼ˆå­—ç¬¦ä¸²ï¼‰</li>
<li>hashï¼ˆå“ˆå¸Œæˆ–æ•£åˆ—ï¼‰</li>
<li>listï¼ˆåˆ—è¡¨ï¼‰</li>
<li>setï¼ˆé›†åˆï¼‰</li>
<li>zset(sorted setï¼Œæœ‰åºé›†åˆ)</li>
</ul>
<h4 id="å­—ç¬¦ä¸²ç±»å‹"><a href="#å­—ç¬¦ä¸²ç±»å‹" class="headerlink" title="å­—ç¬¦ä¸²ç±»å‹"></a>å­—ç¬¦ä¸²ç±»å‹</h4><ol>
<li>èµ‹å€¼å’Œå–å€¼</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">key</span> <span class="keyword">value</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">GET</span> <span class="keyword">key</span>   //å½“é”®ä¸å­˜åœ¨æ—¶ä¼šè¿”å›ç©ºç»“æœ</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>é€’å¢æ•°å­—</li>
</ol>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">INCR key</span></span><br></pre></td></tr></table></figure>

<p>å½“è¦æ“ä½œçš„é”®ä¸å­˜åœ¨æ—¶ï¼Œé»˜è®¤é”®å€¼ä¸º0ï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡é€’å¢åç»“æœä¸º1ï¼Œå¦‚ä¸‹æ‰€ç¤º</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; INCR  num</span><br><span class="line">(<span class="built_in">int</span>eger) <span class="number">1</span></span><br><span class="line">&gt; INCR  num</span><br><span class="line">(<span class="built_in">int</span>eger) <span class="number">2</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>å¢åŠ æŒ‡å®šçš„æ•´æ•°</li>
</ol>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">INCRBY key increment</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>å‡å°‘æŒ‡å®šçš„æ•´æ•°</li>
</ol>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DECR <span class="built_in">key</span></span><br><span class="line"></span><br><span class="line">DECRBY <span class="built_in">key</span> increment</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>å¢åŠ æŒ‡å®šæµ®ç‚¹æ•°</li>
</ol>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">INCRBYFLOAT key  increment</span></span><br></pre></td></tr></table></figure>

<ol start="6">
<li>å‘å°¾éƒ¨è¿½åŠ å€¼</li>
</ol>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">APPEND <span class="built_in">key</span>  <span class="built_in">value</span></span><br></pre></td></tr></table></figure>

<p><code>APPEND</code> å‘½ä»¤ä¸­ï¼Œè‹¥é”®ä¸å­˜åœ¨ï¼Œåˆ™å°†è¯¥é”®çš„å€¼è®¾ä¸º <code>value</code>ï¼Œç›¸å½“äºæ‰§è¡Œäº† <code>SET key value</code>ã€‚</p>
<ol start="7">
<li>è·å–å­—ç¬¦ä¸²é•¿åº¦</li>
</ol>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">STRLEN</span> <span class="built_in">key</span></span><br></pre></td></tr></table></figure>

<p>å¯¹äºæ±‰å­—ï¼ŒRedisä½¿ç”¨UTF-8ç¼–ç çš„ä¸­æ–‡ï¼Œå¦‚ä¸‹ç¤ºä¾‹ä¸­ï¼Œâ€œä½ â€å’Œâ€œå¥½â€ä¸¤ä¸ªå­—çš„UTF-8ç¼–ç çš„é•¿åº¦éƒ½æ˜¯3ï¼Œæ‰€ä»¥è¿”å›çš„å­—ç¬¦ä¸²é•¿åº¦ä¸º6ã€‚</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="keyword">SET</span> key1 ä½ å¥½</span><br><span class="line">OK</span><br><span class="line">&gt; STRLEN <span class="comment">key1</span></span><br><span class="line">(integer) 6</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>åŒæ—¶è·å¾—/è®¾ç½®å¤šä¸ªé”®å€¼</li>
</ol>
<figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MSET key<span class="number">1</span> <span class="keyword">value</span><span class="number">1</span> key<span class="number">2</span> <span class="keyword">value</span><span class="number">2</span> key<span class="number">3</span> <span class="keyword">value</span><span class="number">3</span></span><br><span class="line"></span><br><span class="line">MGET key<span class="number">1</span> key<span class="number">2</span> key<span class="number">3</span></span><br></pre></td></tr></table></figure>


<ol start="9">
<li>ä½æ“ä½œ</li>
</ol>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GETBIT <span class="built_in">key</span> offset   <span class="comment">//è·å–ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹é”®æŒ‡å®šä½ç½®çš„äºŒè¿›åˆ¶ä½çš„å€¼ï¼ˆ0æˆ–1ï¼‰</span></span><br><span class="line"> </span><br><span class="line">SETBIT <span class="built_in">key</span> offset value  <span class="comment">//è®¾ç½®æŒ‡å®šä½ç½®çš„äºŒè¿›åˆ¶ä½çš„å€¼</span></span><br><span class="line"></span><br><span class="line">BITCOUNT <span class="built_in">key</span> [start] [<span class="keyword">end</span>] <span class="comment">//è·å¾—å­—ç¬¦ä¸²ç±»å‹é”®ä¸­å€¼æ˜¯1çš„äºŒè¿›åˆ¶ä½ä¸ªæ•°</span></span><br><span class="line"></span><br><span class="line">BITOP operation destkey <span class="built_in">key</span> [<span class="built_in">key</span> ...] <span class="comment">//å¯¹å¤šä¸ªå­—ç¬¦ä¸²ç±»å‹é”®è¿›è¡Œä½è¿ç®—ï¼Œç»“æœå­˜å‚¨åœ¨destkey</span></span><br></pre></td></tr></table></figure>

<p>ä¸€ä¸ªå­—èŠ‚ç”±8ä¸ªäºŒè¿›åˆ¶ä½ç»„æˆã€‚Redis æä¾›äº† 4 ä¸ªå‘½ä»¤å¯ä»¥ç›´æ¥å¯¹äºŒè¿›åˆ¶ä½æ“ä½œã€‚</p>
<p>ä¸‹é¢è¿›è¡Œç¤ºä¾‹åˆ†æã€‚</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> foo <span class="comment">bar</span></span><br></pre></td></tr></table></figure>

<p>â€œbarâ€çš„3ä¸ªå­—æ¯å¯¹åº”çš„ASCIIç åˆ†åˆ«æ˜¯98ï¼Œ97ï¼Œ114ï¼Œè½¬æ¢ä¸ºå¯¹åº”çš„äºŒè¿›åˆ¶æ•°å€¼ï¼Œ<code>foo</code> é”®ä¸­çš„äºŒè¿›åˆ¶ä½ç»“æ„ä¸º<code>01100010,01100001,01110010</code>ã€‚</p>
<p>(1) ä½¿ç”¨ <code>GETBIT key offset</code> è·å–ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹é”®æŒ‡å®šä½ç½®çš„äºŒè¿›åˆ¶ä½çš„å€¼ï¼ˆ0æˆ–1ï¼‰</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis&gt; GETBIT foo <span class="number">6</span></span><br><span class="line">(<span class="built_in">int</span>eger) <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœè·å–çš„äºŒè¿›åˆ¶ä½çš„ç´¢å¼•è¶…å‡ºäº†é”®å€¼çš„äºŒè¿›åˆ¶ä½çš„å®é™…é•¿åº¦ï¼Œåˆ™é»˜è®¤è¿”å› 0</p>
<p>(2) <code>BITOP operation destkey key [key ...]</code> å¯ä»¥å¯¹å¤šä¸ªå­—ç¬¦ä¸²ç±»å‹é”®è¿›è¡Œä½è¿ç®—ï¼Œç»“æœå­˜å‚¨åœ¨ <code>destkey</code></p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SET foo1 bar</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SET foo2 aar</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; BITOP OR res foo1 foo2  <span class="comment">//æˆ–è¿ç®—</span></span><br><span class="line">(<span class="built_in">int</span>eger) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; GET res</span><br><span class="line"><span class="string">"car"</span></span><br></pre></td></tr></table></figure>


<h4 id="å“ˆå¸Œï¼ˆæ•£åˆ—ï¼‰ç±»å‹"><a href="#å“ˆå¸Œï¼ˆæ•£åˆ—ï¼‰ç±»å‹" class="headerlink" title="å“ˆå¸Œï¼ˆæ•£åˆ—ï¼‰ç±»å‹"></a>å“ˆå¸Œï¼ˆæ•£åˆ—ï¼‰ç±»å‹</h4><p>å“ˆå¸Œï¼ˆæˆ–æ•£åˆ—ï¼‰<code>hash</code> ç±»å‹çš„é”®å€¼ä¹Ÿæ˜¯ä¸€ç§å­—å…¸ç»“æ„ï¼Œå…¶å­˜å‚¨äº†å­—æ®µï¼ˆ<code>field</code>ï¼‰å’Œå­—æ®µå€¼çš„æ˜ å°„ï¼Œä½†å­—æ®µå€¼åªèƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œä¸æ”¯æŒå…¶ä»–æ•°æ®ç±»å‹ã€‚</p>
<ol>
<li>èµ‹å€¼å’Œå–å€¼</li>
</ol>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HSET <span class="built_in">key</span> field <span class="built_in">value</span>  <span class="comment">//ä¸åŒºåˆ†æ’å…¥å’Œæ›´æ–°æ“ä½œï¼Œå³æ›´æ–°æ•°æ®æ—¶ä¸ç”¨äº‹å…ˆåˆ¤æ–­æ˜¯å¦å­˜åœ¨ </span></span><br><span class="line">HGET <span class="built_in">key</span> field</span><br><span class="line"></span><br><span class="line">HMSET <span class="built_in">key</span> field <span class="built_in">value</span> [field <span class="built_in">value</span> ...]</span><br><span class="line">HMGET <span class="built_in">key</span> field [field ...]</span><br><span class="line"></span><br><span class="line">HGETALL <span class="built_in">key</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>åˆ¤æ–­å­—æ®µæ˜¯å¦å­˜åœ¨</li>
</ol>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">HEXISTS</span> key <span class="meta">field</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>ä»…ä»…åœ¨å­—æ®µä¸å­˜åœ¨æ˜¯èµ‹å€¼</li>
</ol>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HSETNX <span class="built_in">key</span> field <span class="built_in">value</span></span><br></pre></td></tr></table></figure>

<p><code>HSETNX</code> å’Œ <code>HSET</code> å‘½ä»¤ç±»ä¼¼ï¼ŒåŒºåˆ«åœ¨äºå¦‚æœå­—æ®µå·²ç»å­˜åœ¨ï¼Œ<code>HSETNX</code> å‘½ä»¤å°†ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚</p>
<p><code>HSETNX</code> ä¸­çš„ <code>NX</code> è¡¨ç¤º <code>if Not eXists</code>ã€‚</p>
<ol start="4">
<li>å¢åŠ æ•°å­—</li>
</ol>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">HINCRBY key filed increment</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>åˆ é™¤å­—æ®µ</li>
</ol>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">HDEL</span> key <span class="meta">field</span> [<span class="meta">field</span> ...]</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>åªè·å–å­—æ®µåç§°æˆ–å­—æ®µå€¼</li>
</ol>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HKEYS <span class="built_in">key</span></span><br><span class="line"></span><br><span class="line">HVALS <span class="built_in">key</span></span><br></pre></td></tr></table></figure>
<ol start="7">
<li>è·å¾—å­—æ®µæ•°é‡</li>
</ol>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">HLEN key</span></span><br></pre></td></tr></table></figure>

<h4 id="åˆ—è¡¨ç±»å‹"><a href="#åˆ—è¡¨ç±»å‹" class="headerlink" title="åˆ—è¡¨ç±»å‹"></a>åˆ—è¡¨ç±»å‹</h4><p>åˆ—è¡¨ï¼ˆ<code>list</code>ï¼‰å¯ä»¥å­˜å‚¨ä¸€ä¸ªæœ‰åºçš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œå¸¸ç”¨çš„æ“ä½œæ˜¯å‘åˆ—è¡¨ä¸¤ç«¯æ·»åŠ å…ƒç´ ï¼Œæˆ–è€…è·å–åˆ—è¡¨çš„æŸä¸€ä¸ªç‰‡æ®µã€‚</p>
<p>åˆ—è¡¨ç±»å‹å†…éƒ¨ä½¿ç”¨çš„æ˜¯åŒå‘é“¾è¡¨å®ç°çš„ï¼Œæ‰€ä»¥æƒ³åˆ—è¡¨ä¸¤ç«¯æ·»åŠ å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦æ˜¯ <code>O(1)</code>ï¼Œè·å–è¶Šæ¥è¿‘ä¸¤ç«¯çš„å…ƒç´ é€Ÿåº¦å°±è¶Šå¿«ï¼Œä½†æ˜¯é€šè¿‡ç´¢å¼•è®¿é—®å…ƒç´ ä¼šæ¯”è¾ƒæ…¢ã€‚å› æ­¤ï¼Œé’ˆå¯¹åŒå‘é“¾è¡¨çš„ç‰¹ç‚¹ï¼Œåˆ—è¡¨ç±»å‹ç‰¹åˆ«é€‚åˆå¦‚ä¸‹åœºæ™¯</p>
<ul>
<li>å¦‚ç¤¾äº¤ç½‘ç«™çš„æ–°é²œäº‹ï¼Œæˆ‘ä»¬åªå…³å¿ƒæœ€æ–°å†…å®¹ï¼Œå³ä½¿æ–°é²œäº‹è¾¾åˆ°å‡ åƒä¸‡æ¡ï¼Œè·å–åˆ—è¡¨å°¾éƒ¨çš„100æ¡æœ€æ–°æ•°æ®ä¹Ÿæ˜¯å¾ˆå¿«çš„</li>
<li>å¦‚æ—¥å¿—è®°å½•åœºæ™¯ï¼ŒåŒå‘é“¾è¡¨ä¿è¯äº†æ’å…¥æ–°æ—¥å¿—çš„é€Ÿåº¦ä¸ä¼šå—åˆ°å·²æœ‰æ—¥å¿—æ•°é‡çš„å½±å“</li>
<li>å€ŸåŠ©åˆ—è¡¨ç±»å‹ï¼ŒRedisè¿˜å¯ä»¥ä½œä¸ºé˜Ÿåˆ—ä½¿ç”¨</li>
</ul>
<ol>
<li>å‘åˆ—è¡¨ä¸¤ç«¯å¢åŠ å…ƒç´ </li>
</ol>
<figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LPUSH <span class="built_in">key</span> <span class="built_in">value</span> [<span class="built_in">value</span> ...]   <span class="comment">//å‘åˆ—è¡¨å·¦è¾¹æ’å…¥å…ƒç´ </span></span><br><span class="line">RPUSH <span class="built_in">key</span> <span class="built_in">value</span> [<span class="built_in">value</span> ...]</span><br></pre></td></tr></table></figure>


<ol start="2">
<li>ä»åˆ—è¡¨ä¸¤ç«¯å¼¹å‡ºå…ƒç´ </li>
</ol>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LPOP <span class="built_in">key</span> </span><br><span class="line">RPOP <span class="built_in">key</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>è·å–åˆ—è¡¨ä¸­å…ƒç´ ä¸ªæ•°</li>
</ol>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LLEN <span class="built_in">key</span>     <span class="comment">// å½“é”®ä¸å­˜åœ¨åˆ™è¿”å›0</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>è·å¾—åˆ—è¡¨ç‰‡æ®µ</li>
</ol>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LRANGE key <span class="literal">start</span> <span class="literal">stop</span>   //è¿”å›åŒºé—´[<span class="literal">start</span>,<span class="literal">stop</span>]çš„åˆ—è¡¨ç‰‡æ®µï¼ˆåŒºé—´é—­åˆï¼‰ï¼Œä¸æ”¹å˜åŸåˆ—è¡¨</span><br></pre></td></tr></table></figure>


<ol start="5">
<li>åˆ é™¤åˆ—è¡¨ä¸­æŒ‡å®šçš„å€¼</li>
</ol>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LREM<span class="built_in"> key</span><span class="built_in"> count</span> <span class="keyword">value</span>  </span><br><span class="line">//åˆ é™¤åˆ—è¡¨ä¸­<span class="built_in">å‰count</span>ä¸ªå€¼ä¸º<span class="keyword">value</span>çš„å…ƒç´ ï¼Œè¿”å›å€¼æ˜¯å®é™…åˆ é™¤çš„å…ƒç´ ä¸ªæ•°</span><br></pre></td></tr></table></figure>

<p>å½“ <code>count</code> å¤§äº0æ—¶ï¼Œä¼šä»åˆ—è¡¨å·¦è¾¹å¼€å§‹åˆ é™¤å‰<code>count</code> ä¸ªï¼›å½“å°äº0æ—¶ï¼Œä¼šä»åˆ—è¡¨å³è¾¹è¾¹å¼€å§‹ï¼›å½“ <code>count</code> ç­‰äº0æ—¶ï¼Œä¼šåˆ é™¤åˆ—è¡¨ä¸­æ‰€æœ‰å€¼ä¸º <code>value</code> çš„å…ƒç´ ã€‚</p>
<ol start="6">
<li>è·å¾—/è®¾ç½®æŒ‡å®šç´¢å¼•çš„å…ƒç´ å€¼</li>
</ol>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LINDEX key <span class="keyword">index</span></span><br><span class="line"></span><br><span class="line">LSET <span class="keyword">key</span> <span class="keyword">index</span> <span class="keyword">value</span></span><br></pre></td></tr></table></figure>
<p>è‹¥ <code>index</code> å°äº0ï¼Œè¡¨ç¤ºä»åˆ—è¡¨å³è¾¹å¼€å§‹è®¡ç®—ç´¢å¼•ï¼Œæœ€å³è¾¹çš„å…ƒç´ çš„ç´¢å¼•å€¼æ˜¯ -1ã€‚</p>
<ol start="7">
<li>åªä¿ç•™åˆ—è¡¨æŒ‡å®šç‰‡æ®µ</li>
</ol>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LTRIM key <span class="literal">start</span> <span class="literal">stop</span>   //åªä¿ç•™åŒºé—´[<span class="literal">start</span>,<span class="literal">stop</span>]çš„åˆ—è¡¨ç‰‡æ®µï¼ˆåŒºé—´é—­åˆï¼‰ï¼Œæ”¹å˜äº†åŸåˆ—è¡¨</span><br></pre></td></tr></table></figure>


<ol start="8">
<li>å‘åˆ—è¡¨ä¸­æ’å…¥å…ƒç´ </li>
</ol>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LINSERT key <span class="keyword">BEFORE</span>|<span class="keyword">AFTER</span> pivot <span class="keyword">value</span>   </span><br><span class="line">//ä»å·¦åˆ°å³æŸ¥æ‰¾åˆ—è¡¨çš„pivotå…ƒç´ ï¼Œåœ¨è¯¥å…ƒç´ å‰æˆ–åï¼Œæ’å…¥<span class="keyword">value</span>å…ƒç´ </span><br></pre></td></tr></table></figure>

<ol start="9">
<li>å°†å…ƒç´ ä»ä¸€ä¸ªåˆ—è¡¨è½¬åˆ°å¦ä¸€ä¸ªåˆ—è¡¨</li>
</ol>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RPOPLPUSH <span class="keyword">source</span> destination</span><br><span class="line"><span class="comment">//RPOPLPUSHè¡¨ç¤ºå…ˆæ‰§è¡ŒRPOPï¼Œå†æ‰§è¡ŒLPUSH</span></span><br></pre></td></tr></table></figure>

<h4 id="é›†åˆç±»å‹"><a href="#é›†åˆç±»å‹" class="headerlink" title="é›†åˆç±»å‹"></a>é›†åˆç±»å‹</h4><p>ç›¸æ¯”äºåˆ—è¡¨ï¼Œé›†åˆï¼ˆ<code>set</code>ï¼‰ä¸­çš„å…ƒç´ æ˜¯å…¨å±€å”¯ä¸€çš„ï¼Œå¹¶ä¸”æ˜¯æ— åºçš„ã€‚</p>
<p>é›†åˆï¼ˆ<code>set</code>ï¼‰ç±»å‹åœ¨Rediså†…éƒ¨æ˜¯ä½¿ç”¨å€¼ä¸ºç©ºçš„æ•£åˆ—è¡¨(<code>hash table</code>)å®ç°çš„ï¼Œæ‰€ä»¥å‘é›†åˆä¸­æ’å…¥æˆ–åˆ é™¤å…ƒç´ ï¼Œåˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œè¿™äº›æ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ <code>O(1)</code>ã€‚</p>
<p>æ›´æ–¹ä¾¿çš„æ˜¯ï¼Œé‡‡ç”¨é›†åˆç±»å‹ï¼Œå¤šä¸ªé›†åˆç±»å‹ä¹‹é—´è¿˜å¯ä»¥è¿›è¡Œäº¤é›†ï¼Œå¹¶é›†å’Œå·®é›†è¿ç®—ã€‚</p>
<ol>
<li>å¢åŠ /åˆ é™¤å…ƒç´ </li>
</ol>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SADD <span class="built_in">key</span> <span class="built_in">member</span> [menber ...] //å¦‚æœé”®ä¸å­˜åœ¨ï¼Œåˆ™è‡ªåŠ¨åˆ›å»ºï¼Œè¿”å›å€¼ä¸ºæˆåŠŸåŠ å…¥çš„å…ƒç´ çš„æ•°é‡</span><br><span class="line">SREM <span class="built_in">key</span> <span class="built_in">member</span> [menber ...]</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>è·å¾—é›†åˆæ‰¾é‚£ä¸ªæ‰€æœ‰çš„å…ƒç´ </li>
</ol>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">SMEMBERS key</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­</li>
</ol>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ—¶é—´å¤æ‚åº¦ä½O(1) é€Ÿåº¦è¾ƒå¿«</span></span><br><span class="line">SISMEMBER key <span class="keyword">member</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>é›†åˆä¹‹é—´çš„è¿ç®—</li>
</ol>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SDIFF  <span class="built_in">key</span> [<span class="built_in">key</span> ...]    <span class="comment">//å·®é›†</span></span><br><span class="line">SINTER <span class="built_in">key</span> [<span class="built_in">key</span> ...]    <span class="comment">//äº¤é›†</span></span><br><span class="line">SUNION <span class="built_in">key</span> [<span class="built_in">key</span> ...]    <span class="comment">//å¹¶é›†</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>è·å–é›†åˆä¸­å…ƒç´ ä¸ªæ•°</li>
</ol>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">SCARD key</span></span><br></pre></td></tr></table></figure>


<ol start="6">
<li>è¿›è¡Œé›†åˆè¿ç®—å¹¶å°†ç»“æœå­˜å‚¨</li>
</ol>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SDIFFSTORE destination <span class="built_in">key</span> [<span class="built_in">key</span> ...]</span><br><span class="line">SINTERSTORE destination <span class="built_in">key</span> [<span class="built_in">key</span> ...]</span><br><span class="line">SUNIONSTORE destination <span class="built_in">key</span> [<span class="built_in">key</span> ...]</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>éšæœºè·å¾—é›†åˆä¸­çš„å…ƒç´ </li>
</ol>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SRANDMEMBER </span>key [<span class="built_in">count</span>]</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>ä»é›†åˆä¸­å¼¹å‡ºä¸€ä¸ªå…ƒç´ </li>
</ol>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">SPOP key</span></span><br></pre></td></tr></table></figure>

<h4 id="æœ‰åºé›†åˆç±»å‹"><a href="#æœ‰åºé›†åˆç±»å‹" class="headerlink" title="æœ‰åºé›†åˆç±»å‹"></a>æœ‰åºé›†åˆç±»å‹</h4><p>æœ‰åºé›†åˆ(<code>sorted list</code>)ç±»å‹ï¼Œæ˜¯åœ¨é›†åˆç±»å‹çš„åŸºç¡€ä¸Šï¼Œä¸ºæ¯ä¸ªå…ƒç´ å…³è”ä¸€ä¸ªåˆ†æ•°ï¼ˆ<code>score</code>ï¼Œå¯ä»¥ç†è§£ä¸ºç´¢å¼•å€¼ï¼‰ï¼Œä½¿å¾—å…ƒç´ æœ‰åºã€‚</p>
<p>Redisä¸­ï¼Œé‡‡ç”¨å“ˆå¸Œè¡¨å’Œè·³è·ƒè¡¨ï¼ˆ<code>Skip list</code>ï¼‰å®ç°æœ‰åºé›†åˆç±»å‹ã€‚æ‰€ä»¥å³ä½¿è¯»å–ä½äºä¸­é—´éƒ¨åˆ†çš„æ•°æ®ï¼Œé€Ÿåº¦ä¹Ÿæ˜¯å¾ˆå¿«çš„ï¼ˆæ—¶é—´å¤æ‚åº¦æ˜¯``O(logN)`ï¼‰ã€‚</p>
<ol>
<li>å¢åŠ å…ƒç´ </li>
</ol>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//æ·»åŠ ä¸€ä¸ª<span class="built_in">member</span>å…ƒç´ å’Œè¯¥å…ƒç´ çš„åˆ†æ•°score</span><br><span class="line">ZADD <span class="built_in">key</span> score <span class="built_in">member</span> [score <span class="built_in">member</span>]</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>è·å¾—å…ƒç´ çš„åˆ†æ•°</li>
</ol>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZSCORE <span class="built_in">key</span> <span class="built_in">member</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>è·å¾—æ’ååœ¨æŸä¸ªèŒƒå›´çš„å…ƒç´ åˆ—è¡¨</li>
</ol>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//æŒ‰ç…§å…ƒç´ åˆ†æ•°ä»å°åˆ°å¤§çš„é¡ºåºï¼Œè¿”å›ç´¢å¼•åœ¨åŒºé—´[<span class="built_in">start</span>,<span class="built_in">stop</span>]çš„æ‰€æœ‰å…ƒç´ </span><br><span class="line">//å¦‚æœæœ‰å‚æ•°WITHSCORESï¼Œè¡¨ç¤ºè¿”å›çš„å…ƒç´ åˆ—è¡¨åŒ…å«åˆ†æ•°ä¿¡æ¯</span><br><span class="line">ZRANGE key <span class="built_in">start</span> <span class="built_in">stop</span> [WITHSCORES]</span><br><span class="line"></span><br><span class="line">//ç±»ä¼¼ZRANGEï¼Œåªä¸è¿‡æ˜¯æŒ‰ç…§åˆ†æ•°ä»å¤§åˆ°å°çš„é¡ºåº</span><br><span class="line">ZREVRANGE key <span class="built_in">start</span> <span class="built_in">stop</span> [WITHSCORES]</span><br></pre></td></tr></table></figure>


<ol start="4">
<li>è·å¾—æŒ‡å®šåˆ†æ•°èŒƒå›´çš„å…ƒç´ </li>
</ol>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//æŒ‰ç…§å…ƒç´ åˆ†æ•°ä»å°åˆ°å¤§çš„é¡ºåºï¼Œè¿”å›ç´¢å¼•åœ¨åŒºé—´[<span class="built_in">start</span>,<span class="built_in">stop</span>]çš„æ‰€æœ‰å…ƒç´ </span><br><span class="line">//å¦‚æœæœ‰å‚æ•°WITHSCORESï¼Œè¡¨ç¤ºè¿”å›çš„å…ƒç´ åˆ—è¡¨åŒ…å«åˆ†æ•°ä¿¡æ¯</span><br><span class="line">ZRANGE key <span class="built_in">start</span> <span class="built_in">stop</span> [WITHSCORES]</span><br><span class="line"></span><br><span class="line">//ç±»ä¼¼ZRANGEï¼Œåªä¸è¿‡æ˜¯æŒ‰ç…§åˆ†æ•°ä»å¤§åˆ°å°çš„é¡ºåº</span><br><span class="line">ZREVRANGE key <span class="built_in">start</span> <span class="built_in">stop</span> [WITHSCORES]</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>è·å¾—æŒ‡å®šåˆ†æ•°èŒƒå›´çš„å…ƒç´ </li>
</ol>
<figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//æŒ‰ç…§å…ƒç´ åˆ†æ•°ä»å°åˆ°å¤§ï¼Œè¿”å›åˆ†æ•°åœ¨åŒºé—´[<span class="built_in">min</span>,<span class="built_in">max</span>]ä¹‹é—´çš„å…ƒç´ </span><br><span class="line">//LIMIT <span class="built_in">offset</span> <span class="built_in">count</span> è¡¨ç¤ºåœ¨è·å¾—å…ƒç´ åˆ—è¡¨çš„åŸºç¡€ä¸Šï¼Œå‘ååç§»ï¼ˆè·³è¿‡ï¼‰<span class="built_in">offset</span>ä¸ªå…ƒç´ ï¼Œå¹¶ä¸”åªè·å–ä¹‹åçš„å‰<span class="built_in">count</span>ä¸ªå…ƒç´ </span><br><span class="line">ZRANGEBYSCORE key <span class="built_in">min</span> <span class="built_in">max</span> [WITHSCORES] [LIMIT <span class="built_in">offset</span> <span class="built_in">count</span>]</span><br></pre></td></tr></table></figure>


<ol start="6">
<li>å¢åŠ æŸä¸ªå…ƒç´ çš„åˆ†æ•°</li>
</ol>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZINCRBY <span class="built_in">key</span> increment <span class="built_in">member</span></span><br></pre></td></tr></table></figure>


<ol start="7">
<li>è·å¾—é›†åˆä¸­å…ƒç´ çš„æ•°é‡</li>
</ol>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ZCARD key</span></span><br></pre></td></tr></table></figure>

<ol start="8">
<li>è·å¾—æŒ‡å®šåˆ†æ•°èŒƒå›´å†…çš„å…ƒç´ ä¸ªæ•°</li>
</ol>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZCOUNT <span class="built_in">key</span> <span class="built_in">min</span> <span class="built_in">max</span></span><br></pre></td></tr></table></figure>


<ol start="9">
<li>æŒ‰ç…§æ’åèŒƒå›´åˆ é™¤å…ƒç´ </li>
</ol>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æŒ‰ç…§å…ƒç´ åˆ†æ•°ä»å°åˆ°å¤§é¡ºåºï¼Œåˆ é™¤æŒ‡å®šæ’åèŒƒå›´å†…çš„å…ƒç´ ï¼Œå¹¶è¿”å›åˆ é™¤çš„å…ƒç´ æ•°é‡</span></span><br><span class="line">ZREMRANGEBYRANK <span class="built_in">key</span> start <span class="keyword">stop</span></span><br></pre></td></tr></table></figure>

<ol start="10">
<li>æŒ‰ç…§åˆ†æ•°èŒƒå›´åˆ é™¤å…ƒç´ </li>
</ol>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¿”å›åˆ é™¤çš„å…ƒç´ æ•°é‡</span></span><br><span class="line">ZREMRANGEBYSCORE <span class="built_in">key</span> <span class="built_in">min</span> <span class="built_in">max</span></span><br></pre></td></tr></table></figure>

<ol start="11">
<li>è·å¾—å…ƒç´ çš„æ’å</li>
</ol>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ZRANK key <span class="keyword">member</span>    <span class="comment">//æŒ‰ç…§åˆ†æ•°ä»å°åˆ°å¤§é¡ºåº</span></span><br><span class="line">ZRANK key <span class="keyword">member</span>    <span class="comment">//æŒ‰ç…§åˆ†æ•°ä»å¤§åˆ°å°é¡ºåº</span></span><br></pre></td></tr></table></figure>


<h2 id="Redisè¿›é˜¶"><a href="#Redisè¿›é˜¶" class="headerlink" title="Redisè¿›é˜¶"></a>Redisè¿›é˜¶</h2><h3 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h3><h4 id="MULTI-EXEC"><a href="#MULTI-EXEC" class="headerlink" title="MULTI EXEC"></a>MULTI EXEC</h4><p>äº‹åŠ¡(<code>transaction</code>)æ˜¯ä¸€ç»„å‘½ä»¤çš„é›†åˆï¼Œäº‹åŠ¡åŒå‘½ä»¤ä¸€æ ·ï¼Œéƒ½æ˜¯Redisçš„æœ€å°æ‰§è¡Œå•ä½ã€‚ä¸€ä¸ªäº‹åŠ¡ä¸­çš„å‘½ä»¤è¦ä¹ˆéƒ½æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œã€‚äº‹åŠ¡çš„åº”ç”¨éå¸¸æ™®éï¼Œå¦‚é“¶è¡Œè½¬è´¦ç­‰ã€‚</p>
<p>Redisçš„äº‹åŠ¡è¿˜å¯ä»¥ä¿è¯ä¸€ä¸ªäº‹åŠ¡å†…çš„å‘½ä»¤ä¸€æ¬¡æ‰§è¡Œè€Œä¸è¢«å…¶ä»–å‘½ä»¤æ’å…¥ã€‚</p>
<p>äº‹åŠ¡çš„åŸç†æ˜¯å…ˆå°†å±äºä¸€ä¸ªäº‹åŠ¡çš„å‘½ä»¤å‘é€ç»™Redisï¼Œç„¶åå†è®©Redisä¸€æ¬¡æ‰§è¡Œè¿™äº›å‘½ä»¤ï¼Œä¾‹å¦‚</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">redis&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">redis&gt; SADD <span class="string">"user:1:following"</span> <span class="number">2</span></span><br><span class="line">QUEED</span><br><span class="line">redis&gt; SADD <span class="string">"user:2:following"</span> <span class="number">1</span></span><br><span class="line">QUEED</span><br><span class="line">redis&gt; EXEC</span><br><span class="line"><span class="number">1</span>) (<span class="type">integer</span>) <span class="number">1</span></span><br><span class="line"><span class="number">2</span>) (<span class="type">integer</span>) <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä»£ç æ¼”ç¤ºäº†äº‹åŠ¡çš„ä½¿ç”¨æ–¹å¼ã€‚é¦–å…ˆä½¿ç”¨ <code>MULIL</code> å‘½ä»¤å‘Šè¯‰Redisï¼šâ€œä¸‹é¢æˆ‘å‘ç»™ä½ çš„å‘½ä»¤å±äºåŒä¸€ä¸ªäº‹åŠ¡ï¼Œä½ å…ˆä¸è¦æ‰§è¡Œï¼Œè€Œæ˜¯æŠŠå®ƒä»¬æš‚æ—¶å­˜èµ·æ¥â€ã€‚</p>
<p>éšåå‘é€ä¸¤ä¸ª <code>SADD</code> å‘½ä»¤æ‰§è¡Œäº‹åŠ¡æ“ä½œï¼ŒRedisè¿”å› <code>QUEED</code> è¡¨ç¤ºè¿™2æ¡å‘½ä»¤å·²ç»è¿›å…¥ç­‰å¾…æ‰§è¡Œçš„äº‹åŠ¡é˜Ÿåˆ—ä¸­äº†ã€‚</p>
<p>æœ€åï¼Œå‘é€ <code>EXEC</code> å‘½ä»¤å‘Šè¯‰Rediså°†ç­‰å¾…æ‰§è¡Œçš„äº‹åŠ¡é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å‘½ä»¤æŒ‰ç…§å‘é€é¡ºåºæ‰§è¡Œã€‚</p>
<p><strong>äº‹åŠ¡ä¸­çš„å‘½ä»¤æ˜¯åœ¨ <code>EXEC</code> ä¹‹åæ‰æ‰§è¡Œçš„ï¼Œå› æ­¤ï¼Œä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œåªæœ‰å½“æ‰€æœ‰å‘½ä»¤éƒ½ä¾æ¬¡æ‰§è¡Œå®Œæˆåï¼Œæ‰èƒ½å¾—åˆ°æ¯ä¸ªç»“æœçš„è¿”å›å€¼ã€‚</strong></p>
<h4 id="WATCH"><a href="#WATCH" class="headerlink" title="WATCH"></a>WATCH</h4><p><strong>ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œåªæœ‰å½“æ‰€æœ‰å‘½ä»¤éƒ½ä¾æ¬¡æ‰§è¡Œå®Œæˆåæ‰èƒ½å¾—åˆ°æ¯ä¸ªç»“æœçš„è¿”å›å€¼ã€‚</strong> å¯æ˜¯æœ‰äº›æƒ…å†µä¸‹ï¼Œéœ€è¦å…ˆè·å¾—ä¸€æ¡å‘½ä»¤çš„è¿”å›å€¼ï¼Œæ ¹æ®è¿”å›å€¼å†æ‰§è¡Œä¸‹ä¸€æ¡å‘½ä»¤ã€‚é’ˆå¯¹è¯¥æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ <code>WATCH</code> å‘½ä»¤ã€‚</p>
<p><code>WATCH</code> å‘½ä»¤å¯ä»¥ç›‘æ§ä¸€ä¸ªæˆ–å¤šä¸ªé”®ï¼Œä¸€æ—¦å…¶ä¸­æœ‰ä¸€ä¸ªé”®è¢«ä¿®æ”¹æˆ–åˆ é™¤ï¼Œä¹‹åçš„äº‹åŠ¡å°±ä¸ä¼šæ‰§è¡Œã€‚ç›‘æ§ä¸€ç›´åˆ° <code>EXEC</code> å‘½ä»¤ã€‚ï¼ˆäº‹åŠ¡ä¸­çš„å‘½ä»¤æ˜¯åœ¨ <code>EXEC</code> ä¹‹åæ‰æ‰§è¡Œçš„ï¼Œæ‰€ä»¥åœ¨ <code>MULTI</code> å‘½ä»¤åå¯ä»¥ä¿®æ”¹ <code>WATCH</code> ç›‘æ§çš„é”®å€¼ï¼‰</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">redis&gt; <span class="builtin-name">SET</span> key 1</span><br><span class="line">OK</span><br><span class="line">redis&gt; WATCH key</span><br><span class="line">OK</span><br><span class="line">redis&gt; <span class="builtin-name">SET</span> key 2</span><br><span class="line">OK</span><br><span class="line">redis&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">redis&gt; <span class="builtin-name">SET</span> key 3</span><br><span class="line">QUEED</span><br><span class="line">redis&gt; EXEC</span><br><span class="line"><span class="literal">nil</span></span><br><span class="line">redis&gt; <span class="builtin-name">GET</span> key</span><br><span class="line"><span class="string">"2"</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šä¾‹ä¸­ï¼Œæ‰§è¡Œ <code>WATCH</code> å‘½ä»¤åï¼Œäº‹åŠ¡ä¿®æ”¹äº† <code>key</code> å€¼ï¼Œæ‰€ä»¥æœ€åäº‹åŠ¡ä»£ç å¹¶æ²¡æœ‰æ‰§è¡Œï¼Œ<code>EXEC</code> å‘½ä»¤è¿”å›ç»“æœä¸º <code>nil</code>ã€‚</p>
<p>æ‰§è¡Œ <code>EXEC</code> å‘½ä»¤åæ‚”å–æ¶ˆå¯¹æ‰€æœ‰é”®çš„ç›‘æ§ã€‚</p>
<h3 id="è¿‡æœŸæ—¶é—´"><a href="#è¿‡æœŸæ—¶é—´" class="headerlink" title="è¿‡æœŸæ—¶é—´"></a>è¿‡æœŸæ—¶é—´</h3><p>Redis ä¸­å¯ä»¥ä½¿ç”¨ <code>EXPTRE</code> å‘½ä»¤è®¾ç½®ä¸€ä¸ªé”®çš„è¿‡æœŸæ—¶é—´ï¼Œåˆ°æ—¶é—´å Redis ä¼šè‡ªåŠ¨åˆ é™¤å®ƒã€‚</p>
<ol>
<li>è®¾ç½®è¿‡æœŸæ—¶é—´</li>
</ol>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EXPIRE <span class="built_in">key</span> seconds   <span class="comment">//seconds å•ä½ä¸ºç§’</span></span><br><span class="line"></span><br><span class="line">PEXPIRE <span class="built_in">key</span> milliseconds  <span class="comment">//milliseconds å•ä½ä¸ºæ¯«ç§’</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>æŸ¥è¯¢é”®è¿˜æœ‰å¤šå°‘æ—¶é—´ä¼šè¢«åˆ é™¤</li>
</ol>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">TTL <span class="built_in">key</span>   <span class="comment">//è¿”å›æ—¶é—´å•ä½ä¸ºç§’</span></span><br><span class="line"></span><br><span class="line">PTTL <span class="built_in">key</span>  <span class="comment">//è¿”å›æ—¶é—´å•ä½ä¸ºæ¯«ç§’</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é”®ä¸å­˜åœ¨æ—¶ï¼Œå‘½ä»¤è¿”å›-2</span></span><br><span class="line"><span class="comment">// é”®æœªè®¾ç½®è¿‡æœŸæ—¶é—´æ—¶ï¼Œå‘½ä»¤è¿”å›-1</span></span><br></pre></td></tr></table></figure>


<ol start="3">
<li>å–æ¶ˆé”®çš„è¿‡æœŸæ—¶é—´è®¾ç½®</li>
</ol>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">PERSIST key</span></span><br></pre></td></tr></table></figure>
<p>é™¤äº† <code>PERSIST</code> å‘½ä»¤å¤–ï¼Œä½¿ç”¨ <code>SET</code> æˆ– <code>GETSET</code> å‘½ä»¤ä¸ºé”®èµ‹å€¼ï¼Œä¹Ÿä¼šåŒæ—¶æ¸…é™¤é”®çš„è¿‡æœŸæ—¶é—´ã€‚</p>
<h4 id="å®ç°è®¿é—®é¢‘ç‡é™åˆ¶"><a href="#å®ç°è®¿é—®é¢‘ç‡é™åˆ¶" class="headerlink" title="å®ç°è®¿é—®é¢‘ç‡é™åˆ¶"></a>å®ç°è®¿é—®é¢‘ç‡é™åˆ¶</h4><p>è€ƒè™‘å¦‚ä¸‹åœºæ™¯â€”â€”ä¸ºäº†å‡è½»æœåŠ¡å™¨çš„å‹åŠ›ï¼Œé™åˆ¶æ¯ä¸ªç”¨æˆ·ï¼ˆIPï¼‰æ¯åˆ†é’Ÿæœ€å¤šåªèƒ½è®¿é—®10æ¬¡ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿‡æœŸæ—¶é—´ <code>EXPIRE</code> å®ç°</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ª <code>rate.limiting:userIP</code> çš„é”®</li>
<li>è®¾ç½® <code>EXPIRE key seconds</code>ï¼Œè¿‡æœŸæ—¶é—´ä¸º60sã€‚ä¸€åˆ†é’Ÿåï¼Œè¯¥é”®ä¼šè¢«è‡ªåŠ¨åˆ é™¤</li>
<li>ç”¨æˆ·æ¯æ¬¡è®¿é—®æœåŠ¡å™¨ï¼Œä½¿ç”¨ <code>INCR</code> é€’å¢è¯¥é”®å€¼</li>
<li>å½“è®¿é—®æ¬¡æ•°è¾¾åˆ°10åï¼Œæç¤ºç”¨æˆ·ç¨åè®¿é—®</li>
</ul>
<p>ä¸Šè¿°æµç¨‹çš„ä¼ªä»£ç å¦‚ä¸‹</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$isKeyExists</span> = EXISTS rate.limiting:<span class="variable">$IP</span></span><br><span class="line"><span class="keyword">if</span> isKeyExists is <span class="number">1</span></span><br><span class="line">    <span class="variable">$time</span> = INCR rate.limiting:<span class="variable">$IP</span></span><br><span class="line">    <span class="keyword">if</span> <span class="variable">$time</span> &gt; <span class="number">10</span></span><br><span class="line">        print è®¿é—®é¢‘ç‡è¶…è¿‡äº†é™åˆ¶ï¼Œè¯·ç¨åå†è¯•</span><br><span class="line">        <span class="keyword">exit</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    MULTI           <span class="regexp">//</span>ä½¿ç”¨äº‹åŠ¡ï¼Œé¿å…EXPIREå› ä¸ºæŸç§åŸå› æœªæ‰§è¡Œï¼Œå¯¼è‡´è¯¥é”®å€¼ä¸€ç›´å­˜åœ¨</span><br><span class="line">    INCR rate.limiting:<span class="variable">$IP</span></span><br><span class="line">    EXPIRE <span class="variable">$keyName</span>, <span class="number">60</span></span><br><span class="line">    EXEC</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä»£ç è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚ç”¨æˆ·åœ¨ç¬¬1åˆ†é’Ÿçš„æœ€åä¸€ç§’è®¿é—®äº†9æ¬¡ï¼Œåˆåœ¨ä¸‹ä¸€åˆ†é’Ÿçš„ç¬¬ä¸€ç§’è®¿é—®äº†10æ¬¡ã€‚è¿™ç§è®¿é—®æ˜¯å¯ä»¥é€šè¿‡ä¸Šè¿°è®¿é—®é™åˆ¶çš„ï¼Œä½†å®é™…ä¸Šç”¨æˆ·åœ¨2ç§’å†…è®¿é—®äº†19æ¬¡æœåŠ¡å™¨ã€‚</p>
<p>ä¸ºäº†å¤„ç†ä¸Šè¿°åœºæ™¯ï¼Œå¯ä»¥å¯¹ä»£ç è¿›è¡Œä¼˜åŒ–</p>
<ul>
<li>ä½¿ç”¨ä¸€ä¸ªåˆ—è¡¨å­˜å‚¨ç”¨æˆ·æœ€è¿‘10æ¬¡è®¿é—®æœåŠ¡å™¨çš„æ—¶é—´</li>
<li>ä¸€æ—¦é”®ä¸­çš„å…ƒç´ å¤§äº10ä¸ªï¼Œå°±åˆ¤æ–­æ—¶é—´æœ€æ—©çš„å…ƒç´ è·ç°åœ¨çš„æ—¶é—´æ˜¯å¦å°äº1åˆ†é’Ÿã€‚</li>
<li>å¦‚æœæ˜¯ï¼Œåˆ™è¡¨ç¤ºç”¨æˆ·æœ€è¿‘ä¸€åˆ†é’Ÿçš„è®¿é—®æ¬¡æ•°è¶…è¿‡äº†10æ¬¡ï¼Œè¿›è¡Œé™æµæé†’ã€‚</li>
<li>å¦‚æœä¸æ˜¯ï¼Œå°±å°†ç°åœ¨çš„æ—¶é—´åŠ å…¥åˆ°åˆ—è¡¨ä¸­ï¼ŒåŒæ—¶æŠŠæœ€æ—©çš„å…ƒç´ åˆ é™¤ã€‚</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$listLength</span> = LLEN rate<span class="selector-class">.limiting</span>:<span class="variable">$IP</span></span><br><span class="line"><span class="keyword">if</span> listLength &lt; <span class="number">10</span></span><br><span class="line">    LPUSH rate<span class="selector-class">.limiting</span>:<span class="variable">$IP</span>,now()</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="variable">$time</span> = LINDEX rate<span class="selector-class">.limiting</span>:<span class="variable">$IP</span>, -<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> now() - <span class="variable">$time</span> &gt; <span class="number">60</span></span><br><span class="line">        print è®¿é—®é¢‘ç‡è¶…è¿‡äº†é™åˆ¶ï¼Œè¯·ç¨åå†è¯•</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        LPUSH rate<span class="selector-class">.limiting</span>:<span class="variable">$IP</span>,now()</span><br><span class="line">        LTRIM rate<span class="selector-class">.limiting</span>:<span class="variable">$IP</span>,<span class="number">0</span>,<span class="number">9</span></span><br></pre></td></tr></table></figure>

<h4 id="å®ç°ç¼“å­˜"><a href="#å®ç°ç¼“å­˜" class="headerlink" title="å®ç°ç¼“å­˜"></a>å®ç°ç¼“å­˜</h4><p>ä¸ºäº†æé«˜æœåŠ¡å™¨è´Ÿè½½èƒ½åŠ›ï¼Œå¸¸å¸¸éœ€è¦å°†ä¸€äº›è®¿é—®é¢‘ç‡è¾ƒé«˜ä½†æ˜¯CPUæˆ–åˆ™IOèµ„æºæ¶ˆè€—è¾ƒå¤§çš„æ“ä½œçš„ç»“æœç¼“å­˜èµ·æ¥ï¼Œå¹¶å¸Œæœ›è®©è¿™äº›ç¼“å­˜è¿‡ä¸€æ®µæ—¶é—´åè‡ªåŠ¨è¿‡æœŸã€‚</p>
<p>å®é™…å¼€å‘ä¸­å¾ˆéš¾ä¸ºç¼“å­˜é”®è®¾å®šåˆç†çš„è¿‡æœŸæ—¶é—´ï¼Œä¸ºæ­¤å¯ä»¥é™åˆ¶Rediså¯ä»¥ä½¿ç”¨çš„æœ€å¤§å†…å­˜ï¼Œå¹¶è®©RedisæŒ‰ç…§ä¸€å®šçš„è§„åˆ™æ·˜æ±°ä¸éœ€è¦çš„ç¼“å­˜é”®ã€‚è¿™ç§æ–¹å¼åœ¨åªå°†Redisç”¨ä½œç¼“å­˜ç³»ç»Ÿæ—¶éå¸¸å®ç”¨ã€‚</p>
<p>Redisé…ç½®æ–‡ä»¶çš„ <code>maxmemory</code> å±æ€§é™å®šäº†Rediså¯ä»¥ä½¿ç”¨çš„æœ€å¤§å†…å­˜ã€‚å½“è¶…å‡ºè¿™ä¸ªé™åˆ¶æ—¶ï¼ŒRedisä¼šä¾æ® <code>maxmemory-policy</code> å‚æ•°æŒ‡å®šçš„ç­–ç•¥æ¥åˆ é™¤ä¸è¦çš„é”®å€¼ç›´åˆ°Rediså ç”¨çš„å†…å­˜å¤§å°å°äºæŒ‡å®šå†…å­˜ã€‚</p>
<p><code>maxmemory-policy</code> æ”¯æŒ<code>LRU</code>(<code>Least Recently Used</code>) ç®—æ³•è§„åˆ™ï¼Œå³â€œæœ€è¿‘æœ€å°‘ä½¿ç”¨åŸåˆ™â€ï¼Œå…¶è®¤ä¸ºæœ€è¿‘æœ€å°‘ä½¿ç”¨çš„é”®åœ¨æœªæ¥ä¸€æ®µæ—¶é—´å†…ä¹Ÿä¸ä¼šè¢«ç”¨åˆ°ï¼Œå½“å†…å­˜ä¸è¶³æ—¶è¿™äº›é”®æ˜¯å¯ä»¥è¢«åˆ é™¤çš„ã€‚</p>
<h3 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h3><p><code>SORT</code> å‘½ä»¤å¯ä»¥å¯¹åˆ—è¡¨ç±»å‹ï¼Œé›†åˆç±»å‹å’Œæœ‰åºé›†åˆç±»å‹é”®è¿›è¡Œæ’åºï¼Œå¹¶ä¸”å¯ä»¥å®Œæˆå’Œå…³ç³»æ•°æ®åº“ä¸­çš„è¿æ¥æŸ¥è¯¢ç±»ä¼¼çš„ä»»åŠ¡ã€‚</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SORT key BY å‚è€ƒé”® <span class="builtin-name">GET</span> <span class="built_in">..</span>. STORE destkey</span><br></pre></td></tr></table></figure>
<ul>
<li><code>BY å‚è€ƒé”®</code>ä¸­ï¼Œå¦‚æœæä¾›äº† <code>BY</code> å‚æ•°ï¼Œ<code>SORT</code> å‘½ä»¤å°†ä¸å†ä¾æ®å…ƒç´ è‡ªèº«çš„å€¼è¿›è¡Œæ’åºï¼Œè€Œæ˜¯å¯¹æ¯ä¸ªå…ƒç´ ä½¿ç”¨å…ƒç´ çš„å€¼æ›¿æ¢å‚è€ƒé”®ä¸­çš„ç¬¬ä¸€ä¸ª <code>&quot;*&quot;</code> å¹¶è·å–å…¶å€¼ï¼Œç„¶åä¾æ®è¯¥å€¼å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼Œä¸‹è¿°è¯­å¥å°†è¯»å–å¦‚ <code>post:2</code>ï¼Œ<code>post:6</code>ï¼Œ<code>post:12</code>ï¼Œ<code>post:26</code> å‡ ä¸ªæ•£åˆ—é”®ä¸­çš„ <code>time</code> å­—æ®µçš„å€¼å¹¶ä»¥æ­¤å†³å®šæ’åºç»“æœã€‚</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SORT</span> tag:ruby:posts <span class="keyword">BY</span> <span class="keyword">post</span>:*-&gt;time <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>


<ul>
<li><code>GET</code> å‚æ•°ä¸å½±å“æ’åºï¼Œå®ƒçš„ä½œç”¨æ˜¯ä½¿ <code>SORT</code> å‘½ä»¤çš„è¿”å›ç»“æœä¸å†æ˜¯å…ƒç´ è‡ªèº«çš„å€¼ï¼Œè€Œæ˜¯ <code>GET</code> å‚æ•°ä¸­æŒ‡å®šçš„é”®å€¼ã€‚</li>
<li><code>STORE</code> å‚æ•°ç”¨äºå°†æ’åºç»“æœå­˜å‚¨åˆ°æŒ‡å®šçš„é”®ä¸­</li>
</ul>
<h4 id="æ€§èƒ½ä¼˜åŒ–"><a href="#æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–"></a>æ€§èƒ½ä¼˜åŒ–</h4><p><code>SORT</code> å‘½ä»¤çš„æ—¶é—´å¤æ‚åº¦æ˜¯ <code>O(n+mlog(m))</code>ï¼Œå…¶ä¸­ <code>n</code> è¡¨ç¤ºè¦æ’åºçš„åˆ—è¡¨ï¼ˆæˆ–é›†åˆæˆ–æœ‰åºé›†åˆï¼‰ä¸­çš„å…ƒç´ ä¸ªæ•°ï¼Œ<code>m</code>è¡¨ç¤ºè¦è¿”å›çš„å…ƒç´ ä¸ªæ•°ã€‚å½“ <code>n</code> è¾ƒå¤§çš„æ—¶å€™ï¼Œæ’åºå‘½ä»¤çš„æ€§èƒ½ç›¸å¯¹è¾ƒä½ï¼Œå¹¶ä¸” Redis åœ¨æ’åºå‰ä¼šå»ºç«‹ä¸€ä¸ªé•¿åº¦ä¸º <code>n</code> çš„å®¹å™¨æ¥å­˜å‚¨å¾…æ’åºçš„å…ƒç´ ï¼Œè™½ç„¶æ˜¯ä¸€ä¸ªä¸´æ—¶çš„è¿‡ç¨‹ï¼Œä½†æ˜¯å¦‚æœåŒæ—¶è¿›è¡Œè¾ƒå¤šçš„å¤§æ•°æ®é‡çš„æ’åºæ“ä½œåˆ™ä¼šä¸¥é‡å½±å“æ€§èƒ½ã€‚</p>
<p>æ‰€ä»¥å¼€å‘ä¸­ä½¿ç”¨ <code>SORT</code> å‘½ä»¤éœ€è¦æ³¨æ„</p>
<ol>
<li>å°½å¯èƒ½å‡å°‘å¾…æ’åºé”®ä¸­å…ƒç´ çš„æ•°é‡ï¼ˆä½¿ <code>n</code> å°½å¯èƒ½å°ï¼‰</li>
<li>ä½¿ç”¨ <code>LIMIT</code> å‚æ•°åªè·å–éœ€è¦çš„æ•°æ®ï¼ˆä½¿ <code>m</code> å°½å¯èƒ½å°ï¼‰</li>
<li>å¦‚æœéœ€è¦æ’åºçš„æ•°æ®é‡è¾ƒå¤§ï¼Œå°½å¯èƒ½ä½¿ç”¨ <code>STORE</code> å‚æ•°å°†ç»“æœç¼“å­˜</li>
</ol>
<h3 id="æ¶ˆæ¯é€šçŸ¥"><a href="#æ¶ˆæ¯é€šçŸ¥" class="headerlink" title="æ¶ˆæ¯é€šçŸ¥"></a>æ¶ˆæ¯é€šçŸ¥</h3><h4 id="ä»»åŠ¡é˜Ÿåˆ—"><a href="#ä»»åŠ¡é˜Ÿåˆ—" class="headerlink" title="ä»»åŠ¡é˜Ÿåˆ—"></a>ä»»åŠ¡é˜Ÿåˆ—</h4><p>ä»»åŠ¡é˜Ÿåˆ—ï¼Œå³â€œä¼ é€’ä»»åŠ¡çš„é˜Ÿåˆ—â€ã€‚å’Œä»»åŠ¡é˜Ÿåˆ—è¿›è¡Œäº¤äº’çš„å®ä½“æœ‰ä¸¤ç±»ï¼Œä¸€ç±»æ˜¯ç”Ÿäº§è€…ï¼ˆ<code>producer</code>ï¼‰ï¼Œå¦ä¸€ç±»æ˜¯æ¶ˆè´¹è€…ï¼ˆ<code>consumer</code>ï¼‰ã€‚ç”Ÿäº§è€…ä¼šå°†éœ€è¦å¤„ç†çš„ä»»åŠ¡æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œè€Œæ¶ˆè´¹è€…ä¼šä¸æ–­åœ°ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­è¯»å…¥ä»»åŠ¡ä¿¡æ¯å¹¶æ‰§è¡Œã€‚</p>
<p>ä½¿ç”¨ä»»åŠ¡é˜Ÿåˆ—çš„å¥½å¤„</p>
<ol>
<li>æ¾è€¦åˆï¼šç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¸éœ€è¦çŸ¥é“å½¼æ­¤çš„å®ç°ç»†èŠ‚ï¼Œåªéœ€çº¦å®šå¥½çš„ä»»åŠ¡çš„æè¿°æ ¼å¼å³å¯ã€‚</li>
<li>æ˜“äºæ‰©å±•ï¼šæ¶ˆè´¹è€…å¯ä»¥æ‰©å±•åˆ°å¤šä¸ªï¼Œè€Œä¸”å¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸­ï¼Œå¯ä»¥è½»æ˜“åœ°é™ä½å•å°æœåŠ¡å™¨çš„è´Ÿè½½</li>
</ol>
<h4 id="ä½¿ç”¨Rediså®ç°ä»»åŠ¡é˜Ÿåˆ—"><a href="#ä½¿ç”¨Rediså®ç°ä»»åŠ¡é˜Ÿåˆ—" class="headerlink" title="ä½¿ç”¨Rediså®ç°ä»»åŠ¡é˜Ÿåˆ—"></a>ä½¿ç”¨Rediså®ç°ä»»åŠ¡é˜Ÿåˆ—</h4><p>ä½¿ç”¨Redisçš„åˆ—è¡¨ç»“æ„å’Œ <code>RPOP</code>ï¼Œ<code>LPUSH</code> å‘½ä»¤ï¼Œå¯ä»¥å®ç°ç®€å•çš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œä¼ªä»£ç å¦‚ä¸‹æ‰€ç¤º</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ— é™å¾ªç¯è¯»å–ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„å†…å®¹</span></span><br><span class="line">loop</span><br><span class="line">    <span class="variable">$task</span> = RPOP queue</span><br><span class="line">    <span class="keyword">if</span> <span class="variable">$task</span></span><br><span class="line">        # å¦‚æœä»»åŠ¡é˜Ÿåˆ—ä¸­æœ‰ä»»åŠ¡åˆ™æ‰§è¡Œä»»åŠ¡</span><br><span class="line">        execute(<span class="variable">$task</span>)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        # å¦‚æœæ²¡æœ‰åˆ™ç­‰å¾…1ç§’ï¼Œä»¥å…è¿‡äºé¢‘ç¹åœ°è¯·æ±‚æ•°æ®</span><br><span class="line">        wait 1 second</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ä¼ªä»£ç æœ‰ä¸ªä¸è¶³ä¹‹å¤„ï¼Œå½“ä»»åŠ¡é˜Ÿåˆ—ä¸­æ²¡æœ‰ä»»ä½•ä»»åŠ¡æ—¶ï¼Œæ¶ˆè´¹è€…æ¯ç§’éƒ½ä¼šè°ƒç”¨ä¸€æ¬¡ <code>RPOP</code> å‘½ä»¤æŸ¥è¯¢æ˜¯å¦æœ‰æ–°ä»»åŠ¡ã€‚</p>
<p>å¦‚æœå¯ä»¥å®ç°ä¸€æ—¦æœ‰æ–°ä»»åŠ¡åŠ å…¥ä»»åŠ¡é˜Ÿåˆ—å°±é€šçŸ¥æ¶ˆè´¹è€…å°±å¥½äº†ã€‚å…¶å®å€ŸåŠ© <code>BRPOP</code> å‘½ä»¤å°±å¯ä»¥å®ç°è¿™æ ·çš„éœ€æ±‚ã€‚</p>
<p>å¦‚ä¸Šä¼ªä»£ç å¯ä»¥ä¼˜åŒ–ä¸º</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">loop</span><br><span class="line">    <span class="meta"># å¦‚æœä»»åŠ¡é˜Ÿåˆ—ä¸­æ²¡æœ‰æ–°ä»»åŠ¡ï¼ŒBRPOPå‘½ä»¤ä¼šä¸€ç›´é˜»å¡ï¼Œä¸ä¼šæ‰§è¡Œexecute()</span></span><br><span class="line">    $task = BRPOP queue, <span class="number">0</span></span><br><span class="line">    <span class="meta"># è¿”å›å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ç¬¬2ä¸ªå…ƒç´ æ˜¯æˆ‘ä»¬éœ€è¦çš„ä»»åŠ¡</span></span><br><span class="line">    <span class="built_in">execute</span>($task[1])</span><br></pre></td></tr></table></figure>


<p><strong><code>BRPOP</code> å’Œ <code>RPOP</code> å‘½ä»¤ç±»ä¼¼ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯å½“åˆ—è¡¨ä¸­æ²¡æœ‰å…ƒç´ æ—¶ï¼Œ<code>BRPOP</code> å‘½ä»¤ä¼šä¸€ç›´é˜»å¡è¿æ¥ï¼Œç›´åˆ°æœ‰æ–°å…ƒç´ åŠ å…¥ã€‚</strong> </p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BRPOP <span class="built_in">key</span> [<span class="built_in">key</span> ...] timeout</span><br></pre></td></tr></table></figure>

<p><code>BRPOP</code> å‘½ä»¤æ¥æ”¶2ä¸ªå‚æ•°ï¼Œç¬¬1ä¸ªå‚æ•°æ˜¯é”®åï¼Œç¬¬2ä¸ªå‚æ•°æ˜¯è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ˜¯ç§’ã€‚å½“è¶…è¿‡äº†æ­¤æ—¶é—´ä»ç„¶æ²¡æœ‰è·å¾—æ–°å…ƒç´ çš„è¯ï¼Œå°±ä¼šè¿”å› <code>nil</code>ã€‚å¦‚æœä¼ å…¥æ—¶é—´å‚æ•°ä¸º0ï¼ˆå¦‚ä¸‹ä¼ªä»£ç ç¤ºä¾‹ï¼‰ï¼Œåˆ™è¡¨ç¤ºä¸é™åˆ¶ç­‰å¾…æ—¶é—´ï¼Œå³å¦‚æœæ²¡æœ‰æ–°å…ƒç´ åŠ å…¥é˜Ÿåˆ—å°±ä¼šæ°¸è¿œé˜»å¡ä¸‹å»ã€‚</p>
<p>è·å¾—ä¸€ä¸ªå…ƒç´ åï¼Œ<code>BRPOP</code> å‘½ä»¤ä¼šè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œå…±2ä¸ªå€¼ï¼Œåˆ†åˆ«æ˜¯é”®åå’Œå…ƒç´ å€¼ã€‚ç¬¬2ä¸ªå‚æ•°ï¼Œå…ƒç´ å€¼ï¼Œå°±æ˜¯å¾…å¤„ç†çš„ä»»åŠ¡ã€‚</p>
<h4 id="ä¼˜å…ˆçº§é˜Ÿåˆ—"><a href="#ä¼˜å…ˆçº§é˜Ÿåˆ—" class="headerlink" title="ä¼˜å…ˆçº§é˜Ÿåˆ—"></a>ä¼˜å…ˆçº§é˜Ÿåˆ—</h4><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œé’ˆå¯¹å¤šç§ä¸åŒçš„ä»»åŠ¡ï¼Œç»å¸¸ä¼šéœ€è¦æ ¹æ®ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œå»æ‰§è¡Œä¼˜å…ˆçº§è¾ƒé«˜çš„ä»»åŠ¡ï¼Œå³éœ€è¦å®ç°ä¸€ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚</p>
<p><code>BRPOP</code> å’Œ <code>BLPOP</code> å‘½ä»¤å¯ä»¥åŒæ—¶æ¥æ”¶å¤šä¸ªé”®ï¼Œå¯ä»¥å®ç°ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BRPOP <span class="built_in">key</span> [<span class="built_in">key</span> ...] timeout</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ï¼Œ<code>BLPOP queue:1 queue:2 0</code>ï¼Œè¡¨ç¤ºåŒæ—¶æ£€æµ‹å¤šä¸ªé”®â€”â€”<code>queue:1</code> å’Œ <code>queue:2</code></p>
<ul>
<li>å¦‚æœæ‰€æœ‰é”®éƒ½æ²¡å…ƒç´ åˆ™é˜»å¡</li>
<li>å¦‚æœæœ‰ä¸€ä¸ªé”®æœ‰å…ƒç´ åˆ™ä¼šä»è¯¥é”®ä¸­å¼¹å‡ºå…ƒç´ </li>
<li>å¦‚æœå¤šä¸ªé”®éƒ½æœ‰å…ƒç´ ï¼Œåˆ™æŒ‰ç…§<strong>ä»å·¦åˆ°å³</strong>é¡ºåºè¯»å–ç¬¬ä¸€ä¸ªé”®ä¸­çš„ä¸€ä¸ªå…ƒç´ </li>
</ul>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">redis&gt; LPUSH queue:<span class="number">2</span> task1</span><br><span class="line"><span class="number">1</span>) (<span class="built_in">int</span>eger) <span class="number">1</span></span><br><span class="line">redis&gt; LPUSH queue:<span class="number">3</span> task2</span><br><span class="line"><span class="number">1</span>) (<span class="built_in">int</span>eger) <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">redis&gt;BRPOP queue:<span class="number">1</span> queue:<span class="number">2</span> queue:<span class="number">3</span> <span class="number">0</span></span><br><span class="line"><span class="number">1</span>) <span class="string">"queue:2"</span></span><br><span class="line"><span class="number">2</span>) <span class="string">"task1"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">redis&gt;BLPOP queue:<span class="number">1</span> queue:<span class="number">2</span> queue:<span class="number">3</span> <span class="number">0</span></span><br><span class="line"><span class="number">1</span>) <span class="string">"queue:3"</span></span><br><span class="line"><span class="number">2</span>) <span class="string">"task2"</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ <code>BRPOP</code> åˆ›å»ºä¼˜å…ˆçº§é˜Ÿåˆ—æ—¶ï¼Œ<code>RPOP</code> è¡¨ç¤ºé˜Ÿåˆ—å·¦è¿›å³å‡ºï¼Œå› æ­¤æœ‰å¦‚ä¸‹ç»“æ„ã€‚å³ <code>BRPOP queue:1 queue:2 queue:3 0</code> å‘½ä»¤ä¸­ï¼Œè¶Šé å·¦çš„é”®ä¼˜å…ˆçº§è¶Šé«˜ï¼ˆ<code>queue:1</code> çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œå› æ­¤ä¼šæŒ‰ç…§<strong>ä»å·¦åˆ°å³</strong>é¡ºåºè¯»å–ç¬¬ä¸€ä¸ªé”®ä¸­çš„ä¸€ä¸ªå…ƒç´ ã€‚</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(L-å·¦è¿›)--- | <span class="type">queue</span>:<span class="number">3</span>| <span class="type">queue</span>:<span class="number">2</span>| <span class="type">queue</span>:<span class="number">1</span>| <span class="type">--&gt; (R</span>-å³å‡º)</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ <code>BLPOP</code> åˆ›å»ºä¼˜å…ˆçº§é˜Ÿåˆ—æ—¶ï¼Œ<code>LPOP</code> è¡¨ç¤ºé˜Ÿåˆ—å³è¿›å·¦å‡ºï¼Œå› æ­¤æœ‰å¦‚ä¸‹ç»“æ„ã€‚å³ <code>BLPOP queue:1 queue:2 queue:3 0</code> å‘½ä»¤ä¸­ï¼Œè¶Šé å³çš„é”®ä¼˜å…ˆçº§è¶Šé«˜ï¼ˆ<code>queue:3</code> çš„ä¼˜å…ˆçº§æœ€é«˜ï¼‰ï¼Œå› æ­¤ä¼šæŒ‰ç…§<strong>ä»å³åˆ°å·¦</strong>é¡ºåºè¯»å–ç¬¬ä¸€ä¸ªé”®ä¸­çš„ä¸€ä¸ªå…ƒç´ ã€‚</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(L-å·¦å‡º) &lt;--- | <span class="type">queue</span>:<span class="number">1</span>| <span class="type">queue</span>:<span class="number">2</span>| <span class="type">queue</span>:<span class="number">3</span>| <span class="type">--- (R</span>-å³è¿›)</span><br></pre></td></tr></table></figure>



<h4 id="â€œå‘å¸ƒ-è®¢é˜…â€æ¨¡å¼"><a href="#â€œå‘å¸ƒ-è®¢é˜…â€æ¨¡å¼" class="headerlink" title="â€œå‘å¸ƒ/è®¢é˜…â€æ¨¡å¼"></a>â€œå‘å¸ƒ/è®¢é˜…â€æ¨¡å¼</h4><p>â€œå‘å¸ƒ/è®¢é˜…â€æ¨¡å¼åŒ…å«ä¸¤ç§è§’è‰²ï¼Œåˆ†åˆ«æ˜¯å‘å¸ƒè€…å’Œè®¢é˜…è€…ã€‚è®¢é˜…è€…å¯ä»¥è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªé¢‘é“ï¼ˆ<code>channel</code>ï¼‰ï¼Œå‘å¸ƒè€…å¯ä»¥å‘æŒ‡å®šçš„é¢‘é“å‘é€æ¶ˆæ¯ï¼Œæ‰€æœ‰è®¢é˜…è¯¥é¢‘é“çš„è®¢é˜…è€…éƒ½ä¼šå—åˆ°æ”¹æ¶ˆæ¯ã€‚</p>
<ul>
<li>å‘å¸ƒæ¶ˆæ¯</li>
</ul>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUBLISH channel <span class="keyword">message</span>   <span class="comment">//å‘½ä»¤è¿”å›å€¼è¡¨ç¤ºæ¥æ”¶åˆ°è¿™æ¡æ¶ˆæ¯çš„è®¢é˜…è€…çš„æ•°é‡</span></span><br></pre></td></tr></table></figure>

<p>å‘å¸ƒå‡ºå»çš„æ¶ˆæ¯ä¸ä¼šè¢«æŒä¹…åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´å½“æœ‰å®¢æˆ·è®¢é˜…è¯¥é¢‘é“ <code>channel</code>ååªèƒ½æ”¶åˆ°åç»­å‘å¸ƒçš„æ¶ˆæ¯ï¼Œä¹‹å‰å‘é€çš„æ¶ˆæ¯å°±æ”¶ä¸åˆ°äº†ã€‚</p>
<ul>
<li>è®¢é˜…æ¶ˆæ¯</li>
</ul>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SUBSCRIBE channel <span class="string">[channel ...]</span></span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œ <code>SUBSCRIBE</code> å‘½ä»¤åå®¢æˆ·ç«¯ä¼šè¿›å…¥è®¢é˜…çŠ¶æ€ï¼Œæ­¤çŠ¶æ€ä¸‹çš„å®¢æˆ·ç«¯ä¸èƒ½ä½¿ç”¨ <code>SUBSCRIBE</code>, <code>UNSUBSCRIBE</code>, <code>PSUBSCRIBE</code> å’Œ <code>PUNSUBSCRIBE</code> è¿™4ä¸ªå±äº â€œå‘å¸ƒ/è®¢é˜…â€æ¨¡å¼çš„å‘½ä»¤ä¹‹å¤–çš„å‘½ä»¤ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p>
<p>è¿›å…¥è®¢é˜…çŠ¶æ€åçš„å®¢æˆ·ç«¯ï¼Œå¯èƒ½æ”¶åˆ°3ç§ç±»å‹çš„å›å¤ï¼Œæ¯ç§ç±»å‹çš„å›å¤éƒ½åŒ…æ‹¬3ä¸ªå€¼ã€‚ç¬¬ä¸€ä¸ªå€¼æ˜¯æ¶ˆæ¯ç±»å‹ï¼Œæ ¹æ®æ¶ˆæ¯ç±»å‹çš„ä¸åŒï¼Œç¬¬äºŒï¼Œç¬¬ä¸‰ä¸ªå€¼çš„å«ä¹‰ä¹Ÿä¸åŒã€‚æ¶ˆæ¯ç±»å‹çš„å–å€¼å¯èƒ½æœ‰ä»¥ä¸‹3ä¸ª</p>
<ol>
<li><code>subscribe</code>ã€‚è¡¨ç¤ºè®¢é˜…æ¶ˆæ¯æˆåŠŸçš„åé¦ˆã€‚ç¬¬2ä¸ªå€¼æ˜¯è®¢é˜…æˆåŠŸçš„é¢‘é“åç§°ï¼Œç¬¬3ä¸ªå€¼æ˜¯å½“å‰å®¢æˆ·ç«¯è®¢é˜…çš„é¢‘é“æ•°é‡</li>
<li><code>message</code>ã€‚è¡¨ç¤ºæ¥æ”¶åˆ°çš„æ¶ˆæ¯ã€‚ç¬¬2ä¸ªå‚æ•°è¡¨ç¤ºé¢‘é“åç§°ï¼Œç¬¬3ä¸ªå‚æ•°æ˜¯æ¶ˆæ¯å†…å®¹</li>
<li><code>unscribe</code>ã€‚è¡¨ç¤ºæˆåŠŸå–æ¶ˆè®¢é˜…æŸä¸ªé¢‘é“ã€‚ç¬¬2ä¸ªå‚æ•°è¡¨ç¤ºé¢‘é“åç§°ï¼Œç¬¬3ä¸ªå‚æ•°æ˜¯å½“å‰å®¢æˆ·ç«¯è®¢é˜…çš„é¢‘é“æ•°é‡ï¼Œå½“è¯¥å€¼ä¸º0æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šé€€å‡ºè®¢é˜…çŠ¶æ€ã€‚</li>
</ol>
<p>ä¸‹é¢çœ‹ä¸€ä¸ªå®ä¾‹ã€‚</p>
<ol>
<li>é¦–å…ˆRedisçš„ä¸€ä¸ªå®ä¾‹RedisAåœ¨é¢‘é“ <code>channel1.1</code> å‘å¸ƒä¸€ä¸ªæ¶ˆæ¯</li>
</ol>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//RedisA</span></span><br><span class="line">redisA&gt; PUBLISH channel1<span class="number">.1</span> hi</span><br><span class="line">(<span class="built_in">int</span>eger) <span class="number">0</span>     <span class="comment">//è¡¨ç¤ºå½“å‰æ²¡æœ‰å®¢æˆ·ç«¯è®¢é˜…è¯¥æ¶ˆæ¯</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>Redisçš„å¦å¤–ä¸€ä¸ªå®ä¾‹RedisB è®¢é˜…é¢‘é“ <code>channel1.1</code></li>
</ol>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//RedisB</span></span><br><span class="line">redisB&gt; SUBSCRIBE channel1<span class="number">.1</span></span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line"><span class="number">1</span>) <span class="string">"subscribe"</span>   <span class="comment">//è®¢é˜…æ¶ˆæ¯æˆåŠŸ</span></span><br><span class="line"><span class="number">2</span>) <span class="string">"channel1.1"</span></span><br><span class="line"><span class="number">3</span>) (<span class="type">integer</span>) <span class="number">1</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>å®ä¾‹RedisAç»§ç»­åœ¨é¢‘é“ <code>channel1.1</code> å‘å¸ƒä¸€ä¸ªæ¶ˆæ¯</li>
</ol>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//RedisA</span></span><br><span class="line">redisA&gt; PUBLISH channel1<span class="number">.1</span> hello</span><br><span class="line">(<span class="built_in">int</span>eger) <span class="number">1</span>     <span class="comment">//è¡¨ç¤ºå½“å‰æ²¡æœ‰å®¢æˆ·ç«¯è®¢é˜…è¯¥æ¶ˆæ¯</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>æ­¤æ—¶ï¼Œå®ä¾‹RedisB ä¼šæ”¶åˆ°å¦‚ä¸‹æ¶ˆæ¯</li>
</ol>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>) <span class="string">"message"</span></span><br><span class="line"><span class="number">2</span>) <span class="string">"channel1.1"</span></span><br><span class="line"><span class="number">3</span>) <span class="string">"hello"</span></span><br></pre></td></tr></table></figure>


<h4 id="æŒ‰ç…§è§„åˆ™è®¢é˜…"><a href="#æŒ‰ç…§è§„åˆ™è®¢é˜…" class="headerlink" title="æŒ‰ç…§è§„åˆ™è®¢é˜…"></a>æŒ‰ç…§è§„åˆ™è®¢é˜…</h4><p>å¯ä»¥ä½¿ç”¨ <code>PSUBSCRIBE</code> è®¢é˜…æŒ‡å®šçš„è§„åˆ™ï¼Œè§„åˆ™æ”¯æŒ <code>glob</code> é£æ ¼é€šé…ç¬¦æ ¼å¼ã€‚</p>
<table>
<thead>
<tr>
<th>ç¬¦å·</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>?</td>
<td>åŒ¹é…ä¸€ä¸ªå­—ç¬¦</td>
</tr>
<tr>
<td>*</td>
<td>åŒ¹é…ä»»æ„ä¸ªï¼ˆåŒ…æ‹¬0ä¸ªï¼‰å­—ç¬¦</td>
</tr>
<tr>
<td>[]</td>
<td>åŒ¹é…æ‹¬å·é—´çš„ä»»ä¸€å­—ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨ <code>-</code> è¡¨ç¤ºä¸€ä¸ªèŒƒå›´ï¼Œå¦‚ <code>[1-9]</code></td>
</tr>
<tr>
<td>\x</td>
<td>ç”¨äºè½¬ä¹‰å­—ç¬¦</td>
</tr>
</tbody></table>
<p>ä¾‹å¦‚ <code>PSUBSCRIBE channel1.?*</code>å‘½ä»¤ä¸­ï¼Œè§„åˆ™ <code>channel1.?*</code> å¯ä»¥åŒ¹é… <code>channel1.1</code> å’Œ <code>channel1.10</code>ï¼Œä½†ä¸ä¼šåŒ¹é… <code>channel1.1</code>ã€‚</p>
<h3 id="ç®¡é“"><a href="#ç®¡é“" class="headerlink" title="ç®¡é“"></a>ç®¡é“</h3><ul>
<li>å®¢æˆ·ç«¯å’ŒRedisä½¿ç”¨TCPåè®®è¿æ¥ã€‚</li>
<li>ä¸è®ºæ˜¯å®¢æˆ·ç«¯å‘Rediså‘é€å‘½ä»¤ï¼Œè¿˜æ˜¯Rediså‘å®¢æˆ·ç«¯è¿”å›å‘½ä»¤ç»“æœï¼Œéƒ½éœ€è¦ç»è¿‡ç½‘ç»œä¼ è¾“ã€‚è¿™ä¸¤ä¸ªéƒ¨åˆ†çš„æ€»è€—æ—¶æˆä¸º<strong>å¾€è¿”æ—¶å»¶ã€‚</strong></li>
<li>å¤§è‡´æ¥è¯´ï¼Œåˆ°æœ¬åœ°å›ç¯åœ°å€ï¼ˆ<code>loop back address</code>ï¼‰çš„å¾€è¿”æ—¶é—´ï¼Œåœ¨æ•°é‡çº§ä¸Šç›¸å½“äºRediså¤„ç†ä¸€æ¡ç®€å•å‘½ä»¤ (å¦‚ <code>LPUSH list 1 2 3</code>) çš„æ—¶é—´ã€‚</li>
<li>Redisçš„åº•å±‚é€šä¿¡åè®®å¯¹ç®¡é“ï¼ˆ<code>pipelining</code>ï¼‰æä¾›äº†æ”¯æŒã€‚é€šè¿‡ç®¡é“å¯ä»¥ä¸€æ¬¡æ€§å‘é€å¤šæ¡å‘½ä»¤å¹¶åœ¨æ‰§è¡Œå®Œåä¸€æ¬¡æ€§å°†ç»“æœè¿”å›ã€‚</li>
<li>å½“ä¸€ç»„å‘½ä»¤ä¸­æ¯æ¡å‘½ä»¤éƒ½ä¸ä¾èµ–äºä¹‹å‰å‘½ä»¤çš„æ‰§è¡Œç»“æœæ—¶å°±å¯ä»¥å°†è¿™ä¸€ç»„å‘½ä»¤ä¸€èµ·é€šè¿‡ç®¡é“å‘å‡ºã€‚ç®¡é“é€šè¿‡å‡å°‘å®¢æˆ·ç«¯å’ŒRedisçš„é€šä¿¡æ¬¡æ•°ï¼Œæ¥å®ç°é™ä½å¾€è¿”æ—¶å»¶ç´¯è®¡å€¼çš„ç›®çš„ã€‚</li>
</ul>
<p><img src="https://image-bed-20181207-1257458714.cos.ap-shanghai.myqcloud.com/back-end-2020/redis-basic-pipelining-1.png" alt=""></p>
<h3 id="èŠ‚çœç©ºé—´"><a href="#èŠ‚çœç©ºé—´" class="headerlink" title="èŠ‚çœç©ºé—´"></a>èŠ‚çœç©ºé—´</h3><p>Redisæ˜¯ä¸€ä¸ªåŸºäºå†…å­˜çš„æ•°æ®åº“ï¼Œæ‰€æœ‰æ•°æ®éƒ½å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚å› æ­¤å¦‚ä½•èŠ‚çœå†…å­˜ï¼Œæ§åˆ¶æˆæœ¬ï¼Œè‡³å…³é‡è¦ã€‚èŠ‚çœå†…å­˜ç©ºé—´ï¼Œå¯ä»¥ä»ä»¥ä¸‹æ–¹é¢è€ƒè™‘</p>
<ol>
<li>ç²¾ç®€é”®åå’Œé”®å€¼</li>
<li>å†…éƒ¨ç¼–ç ä¼˜åŒ–</li>
</ol>
<p>Redisä¸ºæ¯ç§æ•°æ®ç±»å‹éƒ½æä¾›äº†2ç§å†…éƒ¨ç¼–ç æ–¹å¼ï¼Œç”¨äºèŠ‚çœå†…å­˜ç©ºé—´ã€‚</p>
<p>ä»¥æ•£åˆ—ç±»å‹ä¸ºä¾‹ï¼Œæ•£åˆ—ç±»å‹æ˜¯é€šè¿‡æ•£åˆ—è¡¨å®ç°çš„ï¼Œè¿™æ ·å¯ä»¥å®ç°æ—¶é—´å¤æ‚åº¦ <code>O(1)</code> çš„æŸ¥æ‰¾ï¼Œèµ‹å€¼æ“ä½œã€‚ç„¶è€Œå½“å…ƒç´ è¾ƒå°‘æ—¶ï¼Œ<code>O(1)</code>çš„æ“ä½œå¹¶ä¸ä¼šæ¯” <code>O(n)</code> æœ‰æ˜æ˜¾çš„æ€§èƒ½æé«˜ã€‚æ‰€ä»¥Redisä¼šæ ¹æ®å®é™…æƒ…å†µè‡ªåŠ¨è°ƒæ•´ï¼Œé‡‡ç”¨ä¸€ç§æ›´ä¸ºç´§å‡‘ä½†æ€§èƒ½ç¨å·®ï¼ˆæŸ¥æ‰¾å…ƒç´ çš„å¤æ‚åº¦ä¸º<code>O(n)</code>ï¼‰çš„ç¼–ç æ–¹å¼ã€‚</p>
<p><strong>å†…éƒ¨ç¼–ç æ–¹å¼çš„é€‰æ‹©ï¼Œå¯¹äºå¼€å‘è€…æ¥è¯´æ˜¯é€æ˜çš„ã€‚</strong> å¯ä»¥ä½¿ç”¨ <code>OBJECT ENCODING key</code> å‘½ä»¤æŸ¥çœ‹æŸä¸ªé”®çš„å†…éƒ¨ç¼–ç æ–¹å¼ã€‚</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redis&gt; <span class="keyword">SET</span> foo <span class="comment">bar</span></span><br><span class="line">OK</span><br><span class="line">redis&gt; OBJECT <span class="comment">ENCODING foo</span></span><br><span class="line"><span class="string">"raw"</span></span><br></pre></td></tr></table></figure>

<h2 id="Redis-è„šæœ¬"><a href="#Redis-è„šæœ¬" class="headerlink" title="Redis è„šæœ¬"></a>Redis è„šæœ¬</h2><p>Redis è„šæœ¬ä½¿ç”¨ Lua è§£é‡Šå™¨æ¥æ‰§è¡Œè„šæœ¬ã€‚ Redis 2.6 ç‰ˆæœ¬ï¼ˆå’Œä¹‹åç‰ˆæœ¬ï¼‰é€šè¿‡å†…åµŒæ”¯æŒ Lua ç¯å¢ƒã€‚æ‰§è¡Œè„šæœ¬çš„å¸¸ç”¨å‘½ä»¤ä¸º <code>EVAL</code>ã€‚ ä½¿ç”¨è„šæœ¬çš„å¥½å¤„åŒ…æ‹¬</p>
<ol>
<li>å‡å°‘ç½‘ç»œå¼€é”€ï¼šä½¿ç”¨è„šæœ¬å¯ä»¥å°†å¤šä¸ªå‘½ä»¤çš„å¤šæ¬¡è¯·æ±‚ï¼Œé€šè¿‡ä¸€æ¬¡è¯·æ±‚å®Œæˆï¼Œå‡å°‘ç½‘ç»œå¾€è¿”æ—¶å»¶</li>
<li>åŸå­æ“ä½œï¼šRediså°†æ•´ä¸ªè„šæœ¬ä½œä¸ºä¸€ä¸ªæ•´ä½“æ‰§è¡Œï¼Œä¸­é—´ä¸ä¼šè¢«å…¶ä»–å‘½ä»¤æ’å…¥ã€‚å³ç¼–å†™è„šæœ¬è¿‡ç¨‹ä¸­æ— éœ€æ‹…å¿ƒä¼šå‡ºç°ç«æ€æ¡ä»¶ï¼Œä¹Ÿæ— éœ€ä½¿ç”¨äº‹åŠ¡ã€‚äº‹åŠ¡å¯ä»¥å®Œæˆçš„æ‰€æœ‰åŠŸèƒ½éƒ½å¯ä»¥ä½¿ç”¨è„šæœ¬å®ç°ã€‚</li>
<li>å¤ç”¨ï¼šå®¢æˆ·ç«¯å‘é€çš„è„šæœ¬ä¼šæ°¸ä¹…å­˜å‚¨åœ¨Redisä¸­ï¼Œå…¶ä»–å®¢æˆ·ç«¯ä¹Ÿå¯ä»¥å¤ç”¨è¿™ä¸€è„šæœ¬ã€‚</li>
</ol>
<h2 id="Redis-æŒä¹…åŒ–"><a href="#Redis-æŒä¹…åŒ–" class="headerlink" title="Redis æŒä¹…åŒ–"></a>Redis æŒä¹…åŒ–</h2><p>Redis æ”¯æŒ2ç§æ–¹å¼çš„æŒä¹…åŒ–</p>
<ol>
<li><code>RDB</code> æ–¹å¼ï¼šæ ¹æ®æŒ‡å®šçš„è§„åˆ™â€œå®šæ—¶â€å°†å†…å­˜ä¸­çš„æ•°æ®å­˜å‚¨åœ¨ç¡¬ç›˜ä¸Š</li>
<li><code>AOF</code> æ–¹å¼ï¼šæ¯æ¬¡æ‰§è¡Œå‘½ä»¤åå°†å‘½ä»¤æœ¬èº«è®°å½•ä¸‹æ¥</li>
</ol>
<p>é€šè¿‡ <code>RDB</code> æ–¹å¼å®ç°æŒä¹…åŒ–ï¼Œä¸€æ—¦ Redis å¼‚å¸¸é€€å‡ºï¼Œå°±ä¼šä¸¢å¤±æœ€åä¸€æ¬¡å¿«ç…§ä»¥åæ›´æ”¹çš„æ‰€æœ‰æ•°æ®ã€‚å¦‚æœæ•°æ®ç›¸å¯¹é‡è¦ï¼Œå¸Œæœ›æŸå¤±é™åˆ°æœ€å°ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <code>AOF</code> æ–¹å¼è¿›è¡ŒæŒä¹…åŒ–ã€‚</p>
<p>Redis å…è®¸åŒæ—¶å¼€å¯ <code>RDB</code> å’Œ <code>AOF</code> æ–¹å¼ï¼Œæ—¢ä¿è¯äº†æ•°æ®å®‰å…¨åˆä½¿å¾—è¿›è¡Œå¤‡ä»½ç­‰æ“ä½œååˆ†å®¹æ˜“ã€‚æ­¤æ—¶é‡æ–°å¯åŠ¨ Redis åï¼ŒRedis ä¼šä½¿ç”¨ AOF æ–‡ä»¶æ¥æ¢å¤æ•°æ®ï¼Œå› ä¸º AOF æ–¹å¼çš„æŒä¹…åŒ–å¯èƒ½ä¸¢å¤±çš„æ•°æ®æ›´å°‘ã€‚</p>
<h3 id="RDBæ–¹å¼"><a href="#RDBæ–¹å¼" class="headerlink" title="RDBæ–¹å¼"></a>RDBæ–¹å¼</h3><p><code>RDB</code> æ–¹å¼çš„æŒä¹…åŒ–æ˜¯é€šè¿‡å¿«ç…§ï¼ˆ<code>snapshoting</code>ï¼‰å®Œæˆçš„ï¼Œå½“ç¬¦åˆä¸€å®šæ¡ä»¶æ—¶ Redis ä¼šè‡ªåŠ¨å°†å†…å­˜ä¸­çš„æ‰€æœ‰æ•°æ®ç”Ÿæˆä¸€ä»½å‰¯æœ¬å¹¶å­˜å‚¨åœ¨ç¡¬ç›˜ä¸Šï¼Œè¿™ä¸ªè¿‡ç¨‹å³â€œå¿«ç…§â€ã€‚</p>
<h4 id="å¿«ç…§è§¦å‘æ¡ä»¶"><a href="#å¿«ç…§è§¦å‘æ¡ä»¶" class="headerlink" title="å¿«ç…§è§¦å‘æ¡ä»¶"></a>å¿«ç…§è§¦å‘æ¡ä»¶</h4><p>Redis ä¼šåœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µä¸‹å¯¹æ•°æ®è¿›è¡Œå¿«ç…§</p>
<ol>
<li>æ ¹æ®é…ç½®è§„åˆ™è¿›è¡Œè‡ªåŠ¨å¿«ç…§ï¼šæ¯å½“æ—¶é—´çª—å£ M å†…è¢«æ›´æ”¹çš„é”®çš„ä¸ªæ•°å¤§äº N æ—¶ï¼Œå³ç¬¦åˆè‡ªåŠ¨å¿«ç…§æ¡ä»¶</li>
<li>ç”¨æˆ·æ‰§è¡Œ <code>SAVE</code> æˆ– <code>BGSAVE</code> å‘½ä»¤<ul>
<li>æ‰§è¡Œ <code>SAVE</code> å‘½ä»¤æ—¶ï¼ŒRedisåŒæ­¥åœ°æ‰§è¡Œå¿«ç…§æ“ä½œã€‚å¿«ç…§æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šé˜»å¡æ‰€æœ‰æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚æ‰€ä»¥åº”è¯¥å°½é‡é¿å…åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ‰§è¡Œè¯¥æŒ‡ä»¤</li>
<li><code>BGSAVE</code> å‘½ä»¤å¯ä»¥åœ¨åå°å¼‚æ­¥åœ°æ‰§è¡Œå¿«ç…§æ“ä½œï¼ŒåŒæ—¶å¯ä»¥å“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚</li>
</ul>
</li>
<li>æ‰§è¡Œ <code>FLUSHALL</code> å‘½ä»¤<ul>
<li><code>FLUSHALL</code> å‘½ä»¤ä¼šæ¸…æ¥šæ•°æ®åº“ä¸­çš„æ‰€æœ‰æ“ä½œ</li>
<li>åªè¦è‡ªåŠ¨å¿«ç…§æ¡ä»¶ä¸ä¸ºç©ºï¼ˆå³ä½¿ä¸æ»¡è¶³è¯¥æ¡ä»¶ï¼‰ï¼Œæ‰§è¡Œ <code>FLUSHALL</code> å‘½ä»¤åï¼Œä¹Ÿä¼šè§¦å‘å¿«ç…§æ“ä½œ</li>
<li>å½“æ²¡æœ‰å®šä¹‰è‡ªåŠ¨å¿«ç…§æ¡ä»¶æ—¶ï¼Œæ‰§è¡Œ <code>FLUSHALL</code> å‘½ä»¤ä¸ä¼šè§¦å‘å¿«ç…§æ“ä½œ</li>
</ul>
</li>
<li>æ‰§è¡Œå¤åˆ¶ï¼ˆ<code>replication</code>ï¼‰æ—¶ï¼šè®¾ç½®äº†ä¸»ä»æ¨¡å¼æ—¶ï¼ŒRedisä¼šåœ¨å¤åˆ¶åˆå§‹åŒ–æ—¶è¿›è¡Œè‡ªåŠ¨å¿«ç…§</li>
</ol>
<h4 id="å¿«ç…§åŸç†"><a href="#å¿«ç…§åŸç†" class="headerlink" title="å¿«ç…§åŸç†"></a>å¿«ç…§åŸç†</h4><p>Redis é»˜è®¤ä¼šå°†å¿«ç…§æ–‡ä»¶å­˜å‚¨åœ¨ Redis å½“å‰è¿›ç¨‹çš„å·¥ä½œç›®å½•ç§çš„ <code>dump.rdb</code> æ–‡ä»¶ä¸­ã€‚å¿«ç…§çš„è¿‡ç¨‹å¦‚ä¸‹</p>
<ol>
<li>Redis ä½¿ç”¨ <code>fork</code> å‡½æ•°å¤åˆ¶ä¸€ä»½å½“å‰è¿›ç¨‹ï¼ˆçˆ¶è¿›ç¨‹ï¼‰çš„å‰¯æœ¬ï¼ˆå­è¿›ç¨‹ï¼‰</li>
<li>çˆ¶è¿›ç¨‹ç»§ç»­æ¥æ”¶å¹¶å¤„ç†å®¢æˆ·ç«¯å‘æ¥çš„å‘½ä»¤ï¼Œè€Œå­è¿›ç¨‹å¼€å§‹å°†å†…å­˜ä¸­çš„æ•°æ®å†™å…¥ç¡¬ç›˜ä¸­çš„ä¸´æ—¶æ–‡ä»¶</li>
<li>å½“å­è¿›ç¨‹å†™å…¥å®Œæˆæ‰€æœ‰æ•°æ®åä¼šç”¨è¯¥ä¸´æ—¶æ–‡ä»¶æ›¿æ¢æ—§çš„ <code>RDB</code> æ–‡ä»¶ï¼Œè‡³æ­¤ä¸€æ¬¡å¿«ç…§æ“ä½œå®Œæˆã€‚</li>
</ol>
<h3 id="AOFæ–¹å¼"><a href="#AOFæ–¹å¼" class="headerlink" title="AOFæ–¹å¼"></a>AOFæ–¹å¼</h3><p><code>AOF</code>(<code>append only file</code>) æ–¹å¼å¯ä»¥å°† Redis æ‰§è¡Œçš„æ¯ä¸€æ¡å‘½å†™å‘½ä»¤è¿½åŠ åˆ°ç¡¬ç›˜æ–‡ä»¶ä¸­ï¼Œè¿™ä¸€è¿‡ç¨‹æ˜¾ç„¶ä¼šé™ä½ Redis æ€§èƒ½ã€‚ä½†å¤§éƒ¨åˆ†æƒ…å†µä¸‹è¿™ä¸ªå½±å“æ˜¯å¯ä»¥æ¥æ”¶çš„ï¼Œå¦å¤–ä½¿ç”¨è¾ƒå¿«çš„ç¡¬ç›˜å¯ä»¥æé«˜ <code>AOF</code> çš„æ€§èƒ½ã€‚</p>
<ul>
<li>å¼€å¯AOF</li>
</ul>
<p>é»˜è®¤æƒ…å†µä¸‹æ²¡æœ‰å¼€å¯AOFï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å¯ä»¥å¼€å¯AOFã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒAOFæ–‡ä»¶çš„ä¿å­˜ä½ç½®å’ŒRDBæ–‡ä»¶çš„ä½ç½®ç›¸åŒï¼Œé»˜è®¤çš„æ–‡ä»¶åæ˜¯ <code>appendonly.aof</code>ã€‚</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">appendonly</span> <span class="literal">yes</span></span><br></pre></td></tr></table></figure>

<ul>
<li>AOFçš„å®ç°</li>
</ul>
<p>AOF æ–‡ä»¶çš„å†…å®¹æ­£æ˜¯Rediså®¢æˆ·ç«¯å‘Rediså‘é€çš„åŸå§‹é€šä¿¡åè®®çš„å†…å®¹ã€‚</p>
<ul>
<li>åŒæ­¥ç¡¬ç›˜æ•°æ®</li>
</ul>
<p>ç”±äºæ“ä½œç³»ç»Ÿçš„ç¼“å­˜æœºåˆ¶ï¼ŒAOFæ–‡ä»¶æ•°æ®å¹¶æ²¡æœ‰ç›´æ¥çœŸæ­£åœ°å†™å…¥ç¡¬ç›˜ï¼Œè€Œæ˜¯è¿›å…¥äº†ç³»ç»Ÿçš„ç¡¬ç›˜ç¼“å­˜ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ç³»ç»Ÿæ¯ 30 ç§’ä¼šæ‰§è¡Œä¸€æ¬¡åŒæ­¥æ“ä½œï¼Œä»¥ä¾¿å°†ç¡¬ç›˜ç¼“å­˜ä¸­çš„å†…å®¹çœŸæ­£åœ°å†™å…¥ç¡¬ç›˜ã€‚åœ¨è¿™30ç§’å†…ï¼Œå¦‚æœç³»ç»Ÿå¼‚å¸¸é€€å‡ºåˆ™ä¼šå¯¼è‡´ç¡¬ç›˜ç¼“å­˜ä¸­çš„æ•°æ®ä¸¢å¤±ã€‚</p>
<p>ä¸€èˆ¬æ¥è®²ï¼Œå¯ç”¨AOFæŒä¹…åŒ–çš„åº”ç”¨éƒ½æ— æ³•å®¹å¿è¿™æ ·çš„æŸå¤±ã€‚è¿™å°±éœ€è¦ Redis åœ¨å†™å…¥AOF æ–‡ä»¶åä¸»åŠ¨è¦æ±‚ç³»ç»Ÿå°†ç¡¬ç›˜ç¼“å­˜å†…å®¹åŒæ­¥åˆ°ç¡¬ç›˜ä¸­ã€‚åœ¨ Redis ä¸­ï¼Œå¯ä»¥é€šè¿‡ <code>appendfsync</code> å‚æ•°è®¾ç½®åŒæ­¥çš„æ—¶æœº</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># appendfsync always</span></span><br><span class="line">appendfsync everysec   <span class="comment">//é»˜è®¤</span></span><br><span class="line"><span class="meta"># appendfsync no       //ä¸ä¸»åŠ¨è¿›è¡ŒåŒæ­¥æ“ä½œï¼Œå³äº¤ç”±æ“ä½œç³»ç»Ÿå¤„ç†ï¼ˆæ¯30ç§’åŒæ­¥ä¸€æ¬¡ï¼‰</span></span><br></pre></td></tr></table></figure>

<h2 id="é›†ç¾¤"><a href="#é›†ç¾¤" class="headerlink" title="é›†ç¾¤"></a>é›†ç¾¤</h2><p>åŒæ—¶æ‹¥æœ‰å¤šä¸ª Redis æœåŠ¡å™¨åï¼Œå°±ä¼šé¢ä¸´å¦‚æœç®¡ç†é›†ç¾¤çš„é—®é¢˜ï¼ŒåŒ…æ‹¬å¦‚ä½•å¢åŠ èŠ‚ç‚¹ï¼Œæ•…éšœæ¢å¤ç­‰æ“ä½œã€‚</p>
<h3 id="å¤åˆ¶-replication"><a href="#å¤åˆ¶-replication" class="headerlink" title="å¤åˆ¶ replication"></a>å¤åˆ¶ replication</h3><p>ä¸ºäº†é¿å…å•ç‚¹æ•…éšœï¼Œé€šå¸¸çš„åšæ³•æ˜¯å°†æ•°æ®åº“å¤åˆ¶å¤šä¸ªå‰¯æœ¬ä»¥éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šã€‚ä¸ºæ­¤ï¼ŒRedisæä¾›äº†å¤åˆ¶ <code>replication</code> åŠŸèƒ½ï¼Œå¯ä»¥å®ç°å½“ä¸€å°æ•°æ®åº“ä¸­çš„æ•°æ®æ›´æ–°åï¼Œè‡ªåŠ¨å°†æ›´æ–°çš„æ•°æ®åŒæ­¥åˆ°å…¶ä»–æ•°æ®åº“ä¸­ã€‚</p>
<h4 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h4><p>åœ¨å¤åˆ¶çš„æ¦‚å¿µä¸­ï¼Œæ•°æ®åº“åˆ†ä¸º2ç§</p>
<ol>
<li>ä¸»æ•°æ®åº“ï¼ˆ<code>master</code>ï¼‰ï¼šå¯ä»¥è¿›è¡Œè¯»å†™æ“ä½œï¼Œå½“å†™æ“ä½œå¯¼è‡´æ•°æ®å˜åŒ–æ—¶ä¼šè‡ªåŠ¨å°†æ•°æ®åŒæ­¥ç»™ä»æ•°æ®åº“</li>
<li>ä»æ•°æ®åº“ ï¼ˆ<code>slave</code>ï¼‰ï¼šä¸€èˆ¬æ˜¯åªè¯»çš„ï¼ˆä¹Ÿå¯ä»¥é…ç½®ä¸ºå¯å†™å…¥ï¼‰ï¼Œå¹¶æ¥å—ä¸»æ•°æ®åº“åŒæ­¥è¿‡æ¥çš„æ•°æ®</li>
</ol>
<p>Redisä¸­ï¼Œåªéœ€è¦åœ¨ä»æ•°æ®åº“é…ç½®æ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹é…ç½®ï¼Œå³å¯å®Œæˆå¤åˆ¶æ“ä½œï¼Œä¸»æ•°æ®åº“ä¸éœ€è¦ä»»ä½•é…ç½®ã€‚</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">salveof</span> ä¸»æ•°æ®åº“åœ°å€   ä¸»æ•°æ®åº“ç«¯å£</span><br></pre></td></tr></table></figure>

<h4 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><ol>
<li>å¯åŠ¨ä¸€ä¸ªRediså®ä¾‹ä½œä¸ºä¸»æ•°æ®åº“ï¼Œé»˜è®¤ç«¯å£å·æ˜¯6379</li>
</ol>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">$re</span>dis-server    <span class="comment">//é»˜è®¤ç«¯å£å·æ˜¯6379</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å¯åŠ¨å¦ä¸€ä¸ªRediså®ä¾‹ä½œä¸ºä»æ•°æ®åº“ï¼Œç›‘å¬ç«¯å£å· 6380</li>
</ol>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$redis-server   --port <span class="number">6380</span> --slaveof <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="number">6379</span></span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶ä¸»æ•°æ®åº“ä¸­ä»»ä½•æ•°æ®å˜åŒ–ï¼Œéƒ½ä¼šè‡ªåŠ¨åŒæ­¥åˆ°ä»æ•°æ®åº“ä¸­ã€‚</p>
<ol start="3">
<li>æ‰“å¼€ <code>redis-cli</code> å®ä¾‹Aå¹¶è¿æ¥åˆ°ä¸»æ•°æ®åº“ã€‚å†æ‰“å¼€ <code>redis-cli</code> å®ä¾‹Bå¹¶è¿æ¥åˆ°ä»æ•°æ®åº“</li>
</ol>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$redis-cli -p <span class="number">6379</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt;</span><br><span class="line"></span><br><span class="line">$redis-cli -p <span class="number">6380</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6380</span>&gt;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>ä½¿ç”¨ <code>INFO replication</code> å‘½ä»¤åœ¨å®ä¾‹Aå’Œå®ä¾‹Bä¸­æŸ¥çœ‹å¤åˆ¶ç›¸å…³çš„ä¿¡æ¯</li>
</ol>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; INFO replication</span><br><span class="line"># Replication</span><br><span class="line">role:master</span><br><span class="line">connected_slaves:<span class="number">1</span></span><br><span class="line">slave0:ip=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>,port=<span class="number">6380</span>,state=online,offset=<span class="number">336</span>,lag=<span class="number">1</span></span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå®ä¾‹Açš„è§’è‰²æ˜¯ä¸»æ•°æ®åº“ï¼Œå…¶å·²è¿æ¥çš„ä»æ•°æ®åº“çš„ä¸ªæ•°æ˜¯1ã€‚</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6380</span>&gt; INFO replication</span><br><span class="line"># Replication</span><br><span class="line">role:slave</span><br><span class="line">master_host:<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">master_port:<span class="number">6379</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå®ä¾‹Bçš„è§’è‰²æ˜¯ä»æ•°æ®åº“ã€‚</p>
<ol start="5">
<li>åœ¨ä¸»æ•°æ®åº“ä¸­æ·»åŠ é”®å€¼ï¼Œå¯ä»¥åœ¨ä»æ•°æ®åº“ä¸­è¯»å–</li>
</ol>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># ä¸»æ•°æ®åº“å†™å…¥</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; SET foo bar</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># ä»æ•°æ®åº“è¯»å–</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6380</span>&gt; GET foo</span><br><span class="line"><span class="string">"bar"</span></span><br></pre></td></tr></table></figure>


<h4 id="å›¾ç»“æ„"><a href="#å›¾ç»“æ„" class="headerlink" title="å›¾ç»“æ„"></a>å›¾ç»“æ„</h4><p>ä»æ•°æ®åº“ä¸ä»…å¯ä»¥æ¥å—ä¸»æ•°æ®åº“çš„åŒæ­¥æ•°æ®ï¼Œè‡ªå·±ä¹Ÿå¯ä»¥åŒæ—¶ä½œä¸ºä¸»æ•°æ®åº“å­˜åœ¨ï¼Œå½¢æˆç±»ä¼¼å›¾çš„ç»“æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p>ä¸»æ•°æ®Açš„æ•°æ®ä¼šåŒæ­¥åˆ°Bå’ŒCï¼Œè€ŒBä¸­çš„æ•°æ®ä¼šåŒæ­¥åˆ°Då’ŒEä¸­ã€‚å‘Bä¸­å†™å…¥çš„æ•°æ®ä¸ä¼šåŒæ­¥åˆ°Aæˆ–Cä¸­ã€‚</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line"></span><br><span class="line">A<span class="string">[ä¸»æ•°æ®åº“A]</span>--&gt;B<span class="string">[ä»æ•°æ®åº“B]</span></span><br><span class="line">A<span class="string">[ä¸»æ•°æ®åº“A]</span>--&gt;C<span class="string">[ä»æ•°æ®åº“C]</span></span><br><span class="line"></span><br><span class="line">B<span class="string">[ä»æ•°æ®åº“B]</span>--&gt;D<span class="string">[ä»æ•°æ®åº“D]</span></span><br><span class="line">B<span class="string">[ä»æ•°æ®åº“B]</span>--&gt;E<span class="string">[ä»æ•°æ®åº“E]</span></span><br></pre></td></tr></table></figure>





<h3 id="å“¨å…µ"><a href="#å“¨å…µ" class="headerlink" title="å“¨å…µ"></a>å“¨å…µ</h3><h4 id="é¢ä¸´çš„é—®é¢˜"><a href="#é¢ä¸´çš„é—®é¢˜" class="headerlink" title="é¢ä¸´çš„é—®é¢˜"></a>é¢ä¸´çš„é—®é¢˜</h4><p>ä¸ºäº†æé«˜æ€§èƒ½ï¼Œå¯ä»¥é€šè¿‡å¤åˆ¶åŠŸèƒ½å»ºç«‹è‹¥å¹²ä¸ªä»æ•°æ®åº“ï¼Œå¹¶åœ¨ä»æ•°æ®åº“ä¸­å¯ç”¨æŒä¹…åŒ–ï¼ŒåŒæ—¶åœ¨ä¸»æ•°æ®ä¸­ç¦ç”¨æŒä¹…åŒ–ã€‚è¿™æ ·å¯ä»¥ä¿è¯ä¸»æ•°æ®åº“çš„æ€§èƒ½ã€‚</p>
<ol>
<li>å½“ä»æ•°æ®åº“å´©æºƒé‡å¯åï¼Œä¸»æ•°æ®åº“ä¼šè‡ªåŠ¨å°†æ•°æ®åŒæ­¥è¿‡æ¥ï¼Œæ‰€ä»¥æ— éœ€æ‹…å¿ƒæ•°æ®ä¸¢å¤±</li>
<li>å½“ä¸»æ•°æ®åº“å´©æºƒåï¼Œæƒ…å†µå°±æ¯”è¾ƒå¤æ‚äº†ã€‚æ‰‹åŠ¨é€šè¿‡ä»æ•°æ®åº“æ¢å¤ä¸»æ•°æ®åº“æ•°æ®æ—¶ï¼Œéœ€è¦ä¸¥æ ¼æ‰§è¡Œå¦‚ä¸‹2æ­¥<ul>
<li>åœ¨ä»æ•°æ®åº“ä¸­ä½¿ç”¨ <code>SLAVE NO ONE</code> å‘½ä»¤å°†ä»æ•°æ®åº“æå‡ä¸ºä¸»æ•°æ®åº“ç»§ç»­æœåŠ¡</li>
<li>å¯åŠ¨ä¹‹å‰å´©æºƒçš„ä¸»æ•°æ®åº“ï¼Œç„¶åä½¿ç”¨ <code>SLAVEOF</code> å‘½ä»¤å°†å…¶è®¾ç½®æˆæ–°çš„ä¸»æ•°æ®åº“çš„ä»æ•°æ®åº“ï¼Œå³å¯å°†æ•°æ®åŒæ­¥å›æ¥</li>
</ul>
</li>
</ol>
<p>å¯è§ï¼Œæ‰‹åŠ¨ç»´æŠ¤ä¸»ä»æ•°æ®åº“å´©æºƒåçš„æ•°æ®æ¢å¤æ˜¯ç›¸å½“éº»çƒ¦çš„ã€‚Redisæä¾›äº†ä¸€ç§è‡ªåŠ¨åŒ–æ–¹æ¡ˆâ€”â€”å“¨å…µï¼Œé¿å…äº†æ‰‹å·¥ç»´æŠ¤çš„éº»çƒ¦å’Œå®¹æ˜“å‡ºé”™çš„é—®é¢˜ã€‚</p>
<h4 id="å“¨å…µçš„åŠŸèƒ½"><a href="#å“¨å…µçš„åŠŸèƒ½" class="headerlink" title="å“¨å…µçš„åŠŸèƒ½"></a>å“¨å…µçš„åŠŸèƒ½</h4><p>Redis 2.8ä¸­æä¾›äº†å“¨å…µå·¥å…·æ¥å®ç°è‡ªåŠ¨åŒ–çš„ç³»ç»Ÿç›‘æ§å’Œæ•…éšœæ¢å¤åŠŸèƒ½ã€‚</p>
<p>å“¨å…µçš„ä½œç”¨å°±æ˜¯ç›‘æ§ Redis ç³»ç»Ÿçš„è¿è¡ŒçŠ¶å†µï¼Œå®ƒçš„åŠŸèƒ½åŒ…æ‹¬2ä¸ª</p>
<ol>
<li>ç›‘æ§ä¸»æ•°æ®åº“å’Œä»æ•°æ®åº“æ˜¯å¦æ­£å¸¸å·¥ä½œ</li>
<li>ä¸»æ•°æ®åº“å‡ºç°æ•…éšœæ—¶è‡ªåŠ¨å°†ä»æ•°æ®åº“è½¬æ¢ä¸ºä¸»æ•°æ®åº“</li>
</ol>
<p><strong>å“¨å…µæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹</strong>ï¼Œä½¿ç”¨å“¨å…µçš„ä¸€ä¸ªå…¸å‹æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚è™šçº¿è¡¨ç¤ºä¸»ä»å¤åˆ¶å…³ç³»ï¼Œå®çº¿è¡¨ç¤ºå“¨å…µçš„ç›‘æ§è·¯å¾„ã€‚</p>
<p><img src="https://image-bed-20181207-1257458714.cos.ap-shanghai.myqcloud.com/back-end-2020/redis-basic-guard-1.png" alt=""></p>
<p>åœ¨ä¸€ä¸ªä¸€ä¸»å¤šä»çš„Redisç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ªå“¨å…µè¿›è¡Œç›‘æ§ä»»åŠ¡ä»¥ä¿è¯ç³»ç»Ÿæ˜¯è¶³å¤Ÿç¨³å¥çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚æ­¤æ—¶ä¸ä»…å“¨å…µä¼šåŒæ—¶ç›‘æ§ä¸»ä»æ•°æ®åº“ï¼Œå“¨å…µä¹‹é—´ä¹Ÿä¼šäº’ç›¸ç›‘æ§ã€‚</p>
<p><img src="https://image-bed-20181207-1257458714.cos.ap-shanghai.myqcloud.com/back-end-2020/redis-basic-guard-2.png" alt=""></p>
<h4 id="ä½¿ç”¨å“¨å…µ"><a href="#ä½¿ç”¨å“¨å…µ" class="headerlink" title="ä½¿ç”¨å“¨å…µ"></a>ä½¿ç”¨å“¨å…µ</h4><ol>
<li>åˆ›å»ºå“¨å…µé…ç½®æ–‡ä»¶ï¼Œå¦‚ <code>sentinel.conf</code></li>
</ol>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sentinel monitor master-name  ip redis-port quorum</span></span><br><span class="line"></span><br><span class="line">sentinel<span class="built_in"> monitor </span>mymaster 127.0.0.1 6379 1</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œ<code>mymaster</code> æ˜¯è¦ç›‘æ§çš„ä¸»æ•°æ®åº“çš„åç§°ï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªã€‚åé¢çš„å‚æ•°æ˜¯æ•°æ®åº“çš„IPåœ°å€å’Œç«¯å£å·ã€‚</p>
<p>æœ€åçš„å‚æ•° <code>1</code> è¡¨ç¤ºæœ€ä½é€šè¿‡ç¥¨æ•°ï¼ˆ<code>quorum</code>ï¼‰ï¼Œå³æ‰§è¡Œæ•…éšœæ¢å¤æ“ä½œå‰è‡³å°‘éœ€è¦å‡ ä¸ªå“¨å…µèŠ‚ç‚¹åŒæ„ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå– <code>quorum</code> çš„å€¼ä¸º <code>N/2 + 1</code>ï¼Œå…¶ä¸­ <code>N</code> è¡¨ç¤ºå“¨å…µæ•°ç›®ï¼Œå³åªæœ‰è¶…è¿‡ä¸€åŠçš„å“¨å…µåŒæ„åæ‰ä¼šè¿›è¡Œæ•…éšœæ¢å¤ã€‚</p>
<ol start="2">
<li>å¯åŠ¨å“¨å…µè¿›ç¨‹ï¼Œå¹¶å°†ä¸Šè¿°é…ç½®æ–‡ä»¶çš„è·¯å¾„ä¼ é€’ç»™å“¨å…µ</li>
</ol>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$redis-sentinel /path/<span class="keyword">to</span>/sentinel.conf</span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé…ç½®å“¨å…µç›‘æ§ä¸€ä¸ªç³»ç»Ÿæ—¶ï¼Œåªéœ€è¦é…ç½®å…¶ç›‘æ§ä¸»æ•°æ®åº“å³å¯ï¼Œå“¨å…µä¼šè‡ªåŠ¨å‘ç°æ‰€æœ‰å¤åˆ¶è¯¥ä¸»æ•°æ®åº“çš„ä»æ•°æ®åº“ã€‚</p>
<h3 id="é›†ç¾¤-1"><a href="#é›†ç¾¤-1" class="headerlink" title="é›†ç¾¤"></a>é›†ç¾¤</h3><p>Redis 3.0ç‰ˆæœ¬æä¾›äº†é›†ç¾¤ï¼ˆ<code>Cluster</code>ï¼‰ç‰¹æ€§ã€‚é›†ç¾¤çš„ç‰¹ç‚¹åœ¨äºæ‹¥æœ‰å’Œå•æœºå®ä¾‹åŒæ ·çš„æ€§èƒ½ï¼ŒåŒæ—¶åœ¨ç½‘ç»œåˆ†åŒºåèƒ½å¤Ÿæä¾›ä¸€å®šçš„å¯è®¿é—®æ€§ä»¥åŠå¯¹ä¸»æ•°æ®åº“æ•…éšœæ¢å¤çš„æ”¯æŒã€‚</p>

    </div>

    
    
    
        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    æ‰“èµ
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.jpg" alt="Liu Baoshuai å¾®ä¿¡æ”¯ä»˜">
        <p>å¾®ä¿¡æ”¯ä»˜</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.jpg" alt="Liu Baoshuai æ”¯ä»˜å®">
        <p>æ”¯ä»˜å®</p>
      </div>

  </div>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Back-End/" rel="tag"> <i class="fa fa-tag"></i> Back-End</a>
              <a href="/tags/DataBase/" rel="tag"> <i class="fa fa-tag"></i> DataBase</a>
              <a href="/tags/Redis/" rel="tag"> <i class="fa fa-tag"></i> Redis</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/01/12/leetcode-000-overview/" rel="prev" title="LeetCode Notes-000-Overview">
      <i class="fa fa-chevron-left"></i> LeetCode Notes-000-Overview
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/02/01/git-usage-improve/" rel="next" title="Git è¿›é˜¶ä½¿ç”¨">
      Git è¿›é˜¶ä½¿ç”¨ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#æ›´æ–°æ—¥å¿—"><span class="nav-number">1.</span> <span class="nav-text">æ›´æ–°æ—¥å¿—</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å­¦ä¹ èµ„æ–™æ±‡æ€»"><span class="nav-number">2.</span> <span class="nav-text">å­¦ä¹ èµ„æ–™æ±‡æ€»</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis-åˆè¯†"><span class="nav-number">3.</span> <span class="nav-text">Redis åˆè¯†</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redisç¯å¢ƒé…ç½®"><span class="nav-number">4.</span> <span class="nav-text">Redisç¯å¢ƒé…ç½®</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#å®‰è£…-Redis"><span class="nav-number">4.1.</span> <span class="nav-text">å®‰è£… Redis</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å¯åŠ¨-åœæ­¢Redis"><span class="nav-number">4.2.</span> <span class="nav-text">å¯åŠ¨/åœæ­¢Redis</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#redis-cli"><span class="nav-number">4.3.</span> <span class="nav-text">redis-cli</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å¤šæ•°æ®åº“"><span class="nav-number">4.4.</span> <span class="nav-text">å¤šæ•°æ®åº“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis-å…¥é—¨"><span class="nav-number">5.</span> <span class="nav-text">Redis å…¥é—¨</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#å‘½ä»¤è¡ŒåŸºç¡€"><span class="nav-number">5.1.</span> <span class="nav-text">å‘½ä»¤è¡ŒåŸºç¡€</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis-5-ç§æ•°æ®ç±»å‹"><span class="nav-number">5.2.</span> <span class="nav-text">Redis 5 ç§æ•°æ®ç±»å‹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#å­—ç¬¦ä¸²ç±»å‹"><span class="nav-number">5.2.1.</span> <span class="nav-text">å­—ç¬¦ä¸²ç±»å‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å“ˆå¸Œï¼ˆæ•£åˆ—ï¼‰ç±»å‹"><span class="nav-number">5.2.2.</span> <span class="nav-text">å“ˆå¸Œï¼ˆæ•£åˆ—ï¼‰ç±»å‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#åˆ—è¡¨ç±»å‹"><span class="nav-number">5.2.3.</span> <span class="nav-text">åˆ—è¡¨ç±»å‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#é›†åˆç±»å‹"><span class="nav-number">5.2.4.</span> <span class="nav-text">é›†åˆç±»å‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æœ‰åºé›†åˆç±»å‹"><span class="nav-number">5.2.5.</span> <span class="nav-text">æœ‰åºé›†åˆç±»å‹</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redisè¿›é˜¶"><span class="nav-number">6.</span> <span class="nav-text">Redisè¿›é˜¶</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#äº‹åŠ¡"><span class="nav-number">6.1.</span> <span class="nav-text">äº‹åŠ¡</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#MULTI-EXEC"><span class="nav-number">6.1.1.</span> <span class="nav-text">MULTI EXEC</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WATCH"><span class="nav-number">6.1.2.</span> <span class="nav-text">WATCH</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è¿‡æœŸæ—¶é—´"><span class="nav-number">6.2.</span> <span class="nav-text">è¿‡æœŸæ—¶é—´</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#å®ç°è®¿é—®é¢‘ç‡é™åˆ¶"><span class="nav-number">6.2.1.</span> <span class="nav-text">å®ç°è®¿é—®é¢‘ç‡é™åˆ¶</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å®ç°ç¼“å­˜"><span class="nav-number">6.2.2.</span> <span class="nav-text">å®ç°ç¼“å­˜</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ’åº"><span class="nav-number">6.3.</span> <span class="nav-text">æ’åº</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#æ€§èƒ½ä¼˜åŒ–"><span class="nav-number">6.3.1.</span> <span class="nav-text">æ€§èƒ½ä¼˜åŒ–</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#æ¶ˆæ¯é€šçŸ¥"><span class="nav-number">6.4.</span> <span class="nav-text">æ¶ˆæ¯é€šçŸ¥</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ä»»åŠ¡é˜Ÿåˆ—"><span class="nav-number">6.4.1.</span> <span class="nav-text">ä»»åŠ¡é˜Ÿåˆ—</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ä½¿ç”¨Rediså®ç°ä»»åŠ¡é˜Ÿåˆ—"><span class="nav-number">6.4.2.</span> <span class="nav-text">ä½¿ç”¨Rediså®ç°ä»»åŠ¡é˜Ÿåˆ—</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ä¼˜å…ˆçº§é˜Ÿåˆ—"><span class="nav-number">6.4.3.</span> <span class="nav-text">ä¼˜å…ˆçº§é˜Ÿåˆ—</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#â€œå‘å¸ƒ-è®¢é˜…â€æ¨¡å¼"><span class="nav-number">6.4.4.</span> <span class="nav-text">â€œå‘å¸ƒ/è®¢é˜…â€æ¨¡å¼</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æŒ‰ç…§è§„åˆ™è®¢é˜…"><span class="nav-number">6.4.5.</span> <span class="nav-text">æŒ‰ç…§è§„åˆ™è®¢é˜…</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ç®¡é“"><span class="nav-number">6.5.</span> <span class="nav-text">ç®¡é“</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#èŠ‚çœç©ºé—´"><span class="nav-number">6.6.</span> <span class="nav-text">èŠ‚çœç©ºé—´</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis-è„šæœ¬"><span class="nav-number">7.</span> <span class="nav-text">Redis è„šæœ¬</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis-æŒä¹…åŒ–"><span class="nav-number">8.</span> <span class="nav-text">Redis æŒä¹…åŒ–</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#RDBæ–¹å¼"><span class="nav-number">8.1.</span> <span class="nav-text">RDBæ–¹å¼</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#å¿«ç…§è§¦å‘æ¡ä»¶"><span class="nav-number">8.1.1.</span> <span class="nav-text">å¿«ç…§è§¦å‘æ¡ä»¶</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å¿«ç…§åŸç†"><span class="nav-number">8.1.2.</span> <span class="nav-text">å¿«ç…§åŸç†</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AOFæ–¹å¼"><span class="nav-number">8.2.</span> <span class="nav-text">AOFæ–¹å¼</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#é›†ç¾¤"><span class="nav-number">9.</span> <span class="nav-text">é›†ç¾¤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#å¤åˆ¶-replication"><span class="nav-number">9.1.</span> <span class="nav-text">å¤åˆ¶ replication</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#é…ç½®"><span class="nav-number">9.1.1.</span> <span class="nav-text">é…ç½®</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ç¤ºä¾‹"><span class="nav-number">9.1.2.</span> <span class="nav-text">ç¤ºä¾‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å›¾ç»“æ„"><span class="nav-number">9.1.3.</span> <span class="nav-text">å›¾ç»“æ„</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å“¨å…µ"><span class="nav-number">9.2.</span> <span class="nav-text">å“¨å…µ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#é¢ä¸´çš„é—®é¢˜"><span class="nav-number">9.2.1.</span> <span class="nav-text">é¢ä¸´çš„é—®é¢˜</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å“¨å…µçš„åŠŸèƒ½"><span class="nav-number">9.2.2.</span> <span class="nav-text">å“¨å…µçš„åŠŸèƒ½</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ä½¿ç”¨å“¨å…µ"><span class="nav-number">9.2.3.</span> <span class="nav-text">ä½¿ç”¨å“¨å…µ</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#é›†ç¾¤-1"><span class="nav-number">9.3.</span> <span class="nav-text">é›†ç¾¤</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Liu Baoshuai"
      src="https://image-bed-20181207-1257458714.cos.ap-shanghai.myqcloud.com/Blog-20190315/blog-logo-1.jpg">
  <p class="site-author-name" itemprop="name">Liu Baoshuai</p>
  <div class="site-description" itemprop="description">Record and become better myself</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">12</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/lbs0912" title="GitHub â†’ https://github.com/lbs0912" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/mailto:lbs1203940926@163.com" title="E-Mail â†’ mailto:lbs1203940926@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://juejin.im/user/59af7aa96fb9a0248f4aaeab" title="æ˜é‡‘åšå®¢ â†’ https://juejin.im/user/59af7aa96fb9a0248f4aaeab" rel="noopener" target="_blank"><i class="fa fa-fw fa-free-code-camp"></i>æ˜é‡‘åšå®¢</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/2329754491" title="å¾®åš â†’ https://weibo.com/2329754491" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>å¾®åš</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Liu Baoshuai</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> å¼ºåŠ›é©±åŠ¨ v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">ä¸»é¢˜ â€“ <a href="https://pisces.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.7.1
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="æ€»è®¿å®¢é‡">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="æ€»è®¿é—®é‡">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>






  <script>
  function leancloudSelector(url) {
    url = encodeURI(url);
    return document.getElementById(url).querySelector('.leancloud-visitors-count');
  }
  if (CONFIG.page.isPost) {
    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.getAttribute('id'));
      var title = visitors.getAttribute('data-flag-title');

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .then(response => response.json())
              .then(() => {
                leancloudSelector(url).innerText = counter.time + 1;
              })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              })
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }
  } else {
    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.getAttribute('id'));
      });

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url: { '$in': entries } })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length === 0) {
            document.querySelectorAll('.leancloud_visitors .leancloud-visitors-count').forEach(element => {
              element.innerText = 0;
            });
            return;
          }
          for (let item of results) {
            let { url, time } = item;
            leancloudSelector(url).innerText = time;
          }
          for (let url of entries) {
            var element = leancloudSelector(url);
            if (element.innerText == '') {
              element.innerText = 0;
            }
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }
  }

  fetch('https://app-router.leancloud.cn/2/route?appId=gksxcfwJlMV3zkhz1pQc7pl2-gzGzoHsz')
    .then(response => response.json())
    .then(({ api_server }) => {
      var Counter = (method, url, data) => {
        return fetch(`https://${api_server}/1.1${url}`, {
          method: method,
          headers: {
            'X-LC-Id'     : 'gksxcfwJlMV3zkhz1pQc7pl2-gzGzoHsz',
            'X-LC-Key'    : 'kjOanp812G7TIGMSQpPCVIhj',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    });
  </script>


      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>












  

  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://liubaoshuaiBlog.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "https://lbs0912.github.io/2020/01/31/redis-basic/";
    this.page.identifier = "2020/01/31/redis-basic/";
    this.page.title = "RedisåŸºç¡€çŸ¥è¯†æ¢³ç†";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://liubaoshuaiBlog.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

</body>
</html>
